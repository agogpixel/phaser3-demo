/*! For license information please see 2286.d56b458c3c9cdf9a2578.js.LICENSE.txt */
(self.webpackChunk_agogpixel_phaser3_demo=self.webpackChunk_agogpixel_phaser3_demo||[]).push([[2286],{23404:(t,e,i)=>{var r,s,n,a=i(55579),o={supportInverseAlpha:!1,supportNewBlendModes:!1};t.exports=("function"!=typeof importScripts&&void 0!==document&&(o.supportNewBlendModes=(r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",s="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",(n=new Image).onload=function(){var t=new Image;t.onload=function(){var e=a.create(t,6,1).getContext("2d");if(e.globalCompositeOperation="multiply",e.drawImage(n,0,0),e.drawImage(t,2,0),!e.getImageData(2,0,1,1))return!1;var i=e.getImageData(2,0,1,1).data;a.remove(t),o.supportNewBlendModes=255===i[0]&&0===i[1]&&0===i[2]},t.src=r+"/wCKxvRF"+s},n.src=r+"AP804Oa6"+s,!1),o.supportInverseAlpha=function(){var t=a.create(this,2,1).getContext("2d");t.fillStyle="rgba(10, 20, 30, 0.5)",t.fillRect(0,0,1,1);var e=t.getImageData(0,0,1,1);if(null===e)return!1;t.putImageData(e,1,0);var i=t.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3]}()),o)},65125:(t,e,i)=>{var r=i(26088),s=i(25492),n=i(69186),a=i(11318),o=i(26729),h=i(37710),u=i(67833),l=i(48958),c=i(61632),f=i(9329),d=new n({Extends:o,initialize:function(t){o.call(this);var e=t.config;this.config={clearBeforeRender:e.clearBeforeRender,backgroundColor:e.backgroundColor,antialias:e.antialias,roundPixels:e.roundPixels},this.game=t,this.type=a.CANVAS,this.drawCount=0,this.width=0,this.height=0,this.gameCanvas=t.canvas;var i={alpha:t.config.transparent,desynchronized:t.config.desynchronized};this.gameContext=e.context?e.context:this.gameCanvas.getContext("2d",i),this.currentContext=this.gameContext,this.antialias=t.config.antialias,this.blendModes=u(),this.snapshotState={x:0,y:0,width:1,height:1,getPixel:!1,callback:null,type:"image/png",encoder:.92},this._tempMatrix1=new f,this._tempMatrix2=new f,this._tempMatrix3=new f,this.isBooted=!1,this.init()},init:function(){this.game.textures.once(c.READY,this.boot,this)},boot:function(){var t=this.game,e=t.scale.baseSize;this.width=e.width,this.height=e.height,this.isBooted=!0,t.scale.on(l.RESIZE,this.onResize,this),this.resize(e.width,e.height)},onResize:function(t,e){e.width===this.width&&e.height===this.height||this.resize(e.width,e.height)},resize:function(t,e){this.width=t,this.height=e,this.emit(h.RESIZE,t,e)},resetTransform:function(){this.currentContext.setTransform(1,0,0,1,0,0)},setBlendMode:function(t){return this.currentContext.globalCompositeOperation=t,this},setContext:function(t){return this.currentContext=t||this.gameContext,this},setAlpha:function(t){return this.currentContext.globalAlpha=t,this},preRender:function(){var t=this.gameContext,e=this.config,i=this.width,r=this.height;t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),e.clearBeforeRender&&(t.clearRect(0,0,i,r),e.transparent||(t.fillStyle=e.backgroundColor.rgba,t.fillRect(0,0,i,r))),t.save(),this.drawCount=0,this.emit(h.PRE_RENDER)},render:function(t,e,i){var s=e.length;this.emit(h.RENDER,t,i);var n=i.x,a=i.y,o=i.width,u=i.height,l=i.renderToTexture?i.context:t.sys.context;l.save(),this.game.scene.customViewports&&(l.beginPath(),l.rect(n,a,o,u),l.clip()),this.currentContext=l;var c=i.mask;c&&c.preRenderCanvas(this,null,i._maskCamera),i.transparent||(l.fillStyle=i.backgroundColor.rgba,l.fillRect(n,a,o,u)),l.globalAlpha=i.alpha,l.globalCompositeOperation="source-over",this.drawCount+=s,i.renderToTexture&&i.emit(r.PRE_RENDER,i),i.matrix.copyToContext(l);for(var f=0;f<s;f++){var d=e[f];d.mask&&d.mask.preRenderCanvas(this,d,i),d.renderCanvas(this,d,i),d.mask&&d.mask.postRenderCanvas(this,d,i)}l.setTransform(1,0,0,1,0,0),l.globalCompositeOperation="source-over",l.globalAlpha=1,i.flashEffect.postRenderCanvas(l),i.fadeEffect.postRenderCanvas(l),i.dirty=!1,c&&c.postRenderCanvas(this),l.restore(),i.renderToTexture&&(i.emit(r.POST_RENDER,i),i.renderToGame&&t.sys.context.drawImage(i.canvas,n,a))},postRender:function(){this.gameContext.restore(),this.emit(h.POST_RENDER);var t=this.snapshotState;t.callback&&(s(this.gameCanvas,t),t.callback=null)},snapshotCanvas:function(t,e,i,r,n,a,o,h,u){void 0===i&&(i=!1),this.snapshotArea(r,n,a,o,e,h,u);var l=this.snapshotState;return l.getPixel=i,s(this.canvas,l),l.callback=null,this},snapshot:function(t,e,i){return this.snapshotArea(0,0,this.gameCanvas.width,this.gameCanvas.height,t,e,i)},snapshotArea:function(t,e,i,r,s,n,a){var o=this.snapshotState;return o.callback=s,o.type=n,o.encoder=a,o.getPixel=!1,o.x=t,o.y=e,o.width=Math.min(i,this.gameCanvas.width),o.height=Math.min(r,this.gameCanvas.height),this},snapshotPixel:function(t,e,i){return this.snapshotArea(t,e,1,1,i),this.snapshotState.getPixel=!0,this},batchSprite:function(t,e,i,r){var s=i.alpha*t.alpha;if(0!==s){var n=this.currentContext,a=this._tempMatrix1,o=this._tempMatrix2,h=e.canvasData,u=h.x,l=h.y,c=e.cutWidth,f=e.cutHeight,d=e.customPivot,g=e.source.resolution,m=t.displayOriginX,T=t.displayOriginY,v=-m+e.x,p=-T+e.y;if(t.isCropped){var x=t._crop;x.flipX===t.flipX&&x.flipY===t.flipY||e.updateCropUVs(x,t.flipX,t.flipY),c=x.cw,f=x.ch,u=x.cx,l=x.cy,v=-m+x.x,p=-T+x.y,t.flipX&&(v>=0?v=-(v+c):v<0&&(v=Math.abs(v)-c)),t.flipY&&(p>=0?p=-(p+f):p<0&&(p=Math.abs(p)-f))}var E=1,R=1;t.flipX&&(d||(v+=-e.realWidth+2*m),E=-1),t.flipY&&(d||(p+=-e.realHeight+2*T),R=-1),o.applyITRS(t.x,t.y,t.rotation,t.scaleX*E,t.scaleY*R),a.copyFrom(i.matrix),r?(a.multiplyWithOffset(r,-i.scrollX*t.scrollFactorX,-i.scrollY*t.scrollFactorY),o.e=t.x,o.f=t.y):(o.e-=i.scrollX*t.scrollFactorX,o.f-=i.scrollY*t.scrollFactorY),a.multiply(o),n.save(),a.setToContext(n),n.globalCompositeOperation=this.blendModes[t.blendMode],n.globalAlpha=s,n.imageSmoothingEnabled=!(!this.antialias||e.source.scaleMode),t.mask&&t.mask.preRenderCanvas(this,t,i),n.drawImage(e.source.image,u,l,c,f,v,p,c/g,f/g),t.mask&&t.mask.postRenderCanvas(this,t,i),n.restore()}},destroy:function(){this.removeAllListeners(),this.game=null,this.gameCanvas=null,this.gameContext=null}});t.exports=d},67833:(t,e,i)=>{var r=i(87626),s=i(23404);t.exports=function(){var t=[],e=s.supportNewBlendModes,i="source-over";return t[r.NORMAL]=i,t[r.ADD]="lighter",t[r.MULTIPLY]=e?"multiply":i,t[r.SCREEN]=e?"screen":i,t[r.OVERLAY]=e?"overlay":i,t[r.DARKEN]=e?"darken":i,t[r.LIGHTEN]=e?"lighten":i,t[r.COLOR_DODGE]=e?"color-dodge":i,t[r.COLOR_BURN]=e?"color-burn":i,t[r.HARD_LIGHT]=e?"hard-light":i,t[r.SOFT_LIGHT]=e?"soft-light":i,t[r.DIFFERENCE]=e?"difference":i,t[r.EXCLUSION]=e?"exclusion":i,t[r.HUE]=e?"hue":i,t[r.SATURATION]=e?"saturation":i,t[r.COLOR]=e?"color":i,t[r.LUMINOSITY]=e?"luminosity":i,t[r.ERASE]="destination-out",t[r.SOURCE_IN]="source-in",t[r.SOURCE_OUT]="source-out",t[r.SOURCE_ATOP]="source-atop",t[r.DESTINATION_OVER]="destination-over",t[r.DESTINATION_IN]="destination-in",t[r.DESTINATION_OUT]="destination-out",t[r.DESTINATION_ATOP]="destination-atop",t[r.LIGHTER]="lighter",t[r.COPY]="copy",t[r.XOR]="xor",t}},90581:t=>{t.exports="postrender"},1944:t=>{t.exports="prerender"},2567:t=>{t.exports="render"},45864:t=>{t.exports="resize"},37710:(t,e,i)=>{t.exports={POST_RENDER:i(90581),PRE_RENDER:i(1944),RENDER:i(2567),RESIZE:i(45864)}},25492:(t,e,i)=>{var r=i(55579),s=i(13499),n=i(25738);t.exports=function(t,e){var i=n(e,"callback"),a=n(e,"type","image/png"),o=n(e,"encoder",.92),h=Math.abs(Math.round(n(e,"x",0))),u=Math.abs(Math.round(n(e,"y",0))),l=n(e,"width",t.width),c=n(e,"height",t.height);if(n(e,"getPixel",!1)){var f=t.getContext("2d").getImageData(h,u,1,1).data;i.call(null,new s(f[0],f[1],f[2],f[3]/255))}else if(0!==h||0!==u||l!==t.width||c!==t.height){var d=r.createWebGL(this,l,c);d.getContext("2d").drawImage(t,h,u,l,c,0,0,l,c);var g=new Image;g.onerror=function(){i.call(null),r.remove(d)},g.onload=function(){i.call(null,g),r.remove(d)},g.src=d.toDataURL(a,o)}else{var m=new Image;m.onerror=function(){i.call(null)},m.onload=function(){i.call(null,m)},m.src=t.toDataURL(a,o)}}},75913:(t,e,i)=>{var r=i(55579),s=i(13499),n=i(25738);t.exports=function(t,e){var i=t.getContext("experimental-webgl"),a=n(e,"callback"),o=n(e,"type","image/png"),h=n(e,"encoder",.92),u=n(e,"x",0),l=n(e,"y",0),c=n(e,"getPixel",!1),f=n(e,"isFramebuffer",!1),d=f?n(e,"bufferWidth",1):i.drawingBufferWidth,g=f?n(e,"bufferHeight",1):i.drawingBufferHeight;if(c){var m=new Uint8Array(4),T=f?l:g-l;i.readPixels(u,T,1,1,i.RGBA,i.UNSIGNED_BYTE,m),a.call(null,new s(m[0],m[1],m[2],m[3]/255))}else{var v=n(e,"width",d),p=n(e,"height",g),x=new Uint8Array(v*p*4);i.readPixels(u,g-l-p,v,p,i.RGBA,i.UNSIGNED_BYTE,x);for(var E=r.createWebGL(this,v,p),R=E.getContext("2d"),b=R.getImageData(0,0,v,p),S=b.data,A=0;A<p;A++)for(var _=0;_<v;_++){var C=4*((p-A-1)*v+_),F=4*(A*v+_);S[F+0]=x[C+0],S[F+1]=x[C+1],S[F+2]=x[C+2],S[F+3]=x[C+3]}R.putImageData(b,0,0);var M=new Image;M.onerror=function(){a.call(null),r.remove(E)},M.onload=function(){a.call(null,M),r.remove(E)},M.src=E.toDataURL(o,h)}}},37107:(t,e,i)=>{var r=i(69186),s=i(46098),n=i(21342),a=i(18923),o=i(48623),h=i(63174),u=i(14869),l=i(26159),c=i(67239),f=i(57434),d=i(21898),g=new r({initialize:function(t){this.game=t.game,this.renderer=t,this.classes=new n([[s.UTILITY_PIPELINE,d],[s.MULTI_PIPELINE,u],[s.BITMAPMASK_PIPELINE,a],[s.SINGLE_PIPELINE,f],[s.ROPE_PIPELINE,c],[s.LIGHT_PIPELINE,h],[s.POINTLIGHT_PIPELINE,l],[s.GRAPHICS_PIPELINE,o]]),this.postPipelineClasses=new n,this.pipelines=new n,this.current=null,this.previous=null,this.MULTI_PIPELINE=null,this.BITMAPMASK_PIPELINE=null,this.UTILITY_PIPELINE=null,this.fullFrame1,this.fullFrame2,this.halfFrame1,this.halfFrame2},boot:function(t){var e,i,r=this,n=this.game;if(this.classes.each((function(t,i){e=r.add(t,new i({game:n})),t===s.UTILITY_PIPELINE&&(r.UTILITY_PIPELINE=e,r.fullFrame1=e.fullFrame1,r.fullFrame2=e.fullFrame2,r.halfFrame1=e.halfFrame1,r.halfFrame2=e.halfFrame2)})),this.MULTI_PIPELINE=this.get(s.MULTI_PIPELINE),this.BITMAPMASK_PIPELINE=this.get(s.BITMAPMASK_PIPELINE),t)for(i in t){var a=t[i];(e=new a(n)).isPostFX?this.postPipelineClasses.set(i,a):this.has(i)||(this.classes.set(i,a),this.add(i,e))}},add:function(t,e){if(!e.isPostFX){var i=this.pipelines,r=this.renderer;return i.has(t)?console.warn("Pipeline exists: "+t):(e.name=t,e.manager=this,i.set(t,e)),e.hasBooted||e.boot(),0!==r.width&&0!==r.height&&e.resize(r.width,r.height),e}console.warn(t+" is a Post Pipeline. Use `addPostPipeline` instead")},addPostPipeline:function(t,e){this.postPipelineClasses.has(t)||this.postPipelineClasses.set(t,e)},flush:function(){this.current&&this.current.flush()},has:function(t){var e=this.pipelines;return"string"==typeof t?e.has(t):!!e.contains(t)},get:function(t){var e=this.pipelines;return"string"==typeof t?e.get(t):e.contains(t)?t:void 0},getPostPipeline:function(t,e){var i,r=this.postPipelineClasses;if("string"==typeof t?i=r.get(t):"function"==typeof t?r.contains(t)&&(i=t):"object"==typeof t&&(i=r.get(t.name)),i){var s=new i(this.game);return e&&(s.gameObject=e),s}},remove:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.pipelines.delete(t),e&&this.classes.delete(t),i&&this.postPipelineClasses.delete(t)},set:function(t,e,i){if(!t.isPostFX)return this.isCurrent(t,i)||(this.flush(),this.current&&this.current.unbind(),this.current=t,t.bind(i)),t.updateProjectionMatrix(),t.onBind(e),t},preBatch:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=e.length-1;i>=0;i--){var r=e[i];r.active&&r.preBatch(t)}}},postBatch:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=0;i<e.length;i++){var r=e[i];r.active&&r.postBatch(t)}}},preBatchCamera:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=e.length-1;i>=0;i--){var r=e[i];r.active&&r.preBatch(t)}}},postBatchCamera:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=0;i<e.length;i++){var r=e[i];r.active&&r.postBatch(t)}}},isCurrent:function(t,e){var i=this.renderer,r=this.current;return r&&!e&&(e=r.currentShader),!(r!==t||e.program!==i.currentProgram)},copyFrame:function(t,e,i,r,s){return this.setUtility(this.UTILITY_PIPELINE.copyShader).copyFrame(t,e,i,r,s),this},copyToGame:function(t){return this.setUtility(this.UTILITY_PIPELINE.copyShader).copyToGame(t),this},drawFrame:function(t,e,i,r){return this.setUtility(this.UTILITY_PIPELINE.colorMatrixShader).drawFrame(t,e,i,r),this},blendFrames:function(t,e,i,r,s){return this.setUtility(this.UTILITY_PIPELINE.linearShader).blendFrames(t,e,i,r,s),this},blendFramesAdditive:function(t,e,i,r,s){return this.setUtility(this.UTILITY_PIPELINE.addShader).blendFramesAdditive(t,e,i,r,s),this},clearFrame:function(t,e){return this.UTILITY_PIPELINE.clearFrame(t,e),this},blitFrame:function(t,e,i,r,s,n){return this.setUtility(this.UTILITY_PIPELINE.copyShader).blitFrame(t,e,i,r,s,n),this},copyFrameRect:function(t,e,i,r,s,n,a,o){return this.UTILITY_PIPELINE.copyFrameRect(t,e,i,r,s,n,a,o),this},forceZero:function(){return this.current&&this.current.forceZero},setMulti:function(){return this.set(this.MULTI_PIPELINE)},setUtility:function(t){return this.UTILITY_PIPELINE.bind(t)},rebind:function(t){void 0===t&&this.previous&&(t=this.previous);var e=this.renderer,i=e.gl;i.disable(i.DEPTH_TEST),i.disable(i.CULL_FACE),e.hasActiveStencilMask()?i.clear(i.DEPTH_BUFFER_BIT):(i.disable(i.STENCIL_TEST),i.clear(i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)),i.viewport(0,0,e.width,e.height),e.currentProgram=null,e.setBlendMode(0,!0);var r=this.pipelines.entries;for(var s in r)r[s].glReset=!0;t&&(this.current=t,t.rebind()),e.resetTextures()},clear:function(){var t=this.renderer;this.flush(),this.current?(this.current.unbind(),this.previous=this.current,this.current=null):this.previous=null,t.currentProgram=null,t.setBlendMode(0,!0)},destroy:function(){this.flush(),this.classes.clear(),this.postPipelineClasses.clear(),this.pipelines.clear(),this.renderer=null,this.game=null,this.classes=null,this.postPipelineClasses=null,this.pipelines=null,this.current=null,this.previous=null}});t.exports=g},89262:(t,e,i)=>{var r=i(69186),s=i(12229),n=i(26729),a=i(42789),o=i(25738),h=i(54259),u=i(37710),l=i(50666),c=i(64564),f=i(86384),d=new r({Extends:n,initialize:function(t){n.call(this);var e=t.game,i=e.renderer,r=i.gl;this.name=o(t,"name","WebGLPipeline"),this.game=e,this.renderer=i,this.manager,this.gl=r,this.view=e.canvas,this.width=0,this.height=0,this.vertexCount=0,this.vertexCapacity=0,this.vertexData,this.vertexBuffer,this.topology=o(t,"topology",r.TRIANGLES),this.bytes,this.vertexViewF32,this.vertexViewU32,this.active=!0,this.currentUnit=0,this.forceZero=o(t,"forceZero",!1),this.hasBooted=!1,this.isPostFX=!1,this.renderTargets=[],this.currentRenderTarget,this.shaders=[],this.currentShader,this.projectionMatrix,this.projectionWidth=0,this.projectionHeight=0,this.config=t,this.glReset=!1},boot:function(){var t,e=this.gl,i=this.config,r=this.renderer;this.isPostFX||(this.projectionMatrix=(new h).identity());var s=this.renderTargets,n=o(i,"renderTarget",!1);"boolean"==typeof n&&n&&(n=1);var c=r.width,f=r.height;if("number"==typeof n)for(t=0;t<n;t++)s.push(new l(r,c,f,1,0,!0));else if(Array.isArray(n))for(t=0;t<n.length;t++){var d=o(n[t],"scale",1),g=o(n[t],"minFilter",0),m=o(n[t],"autoClear",1);s.push(new l(r,c,f,d,g,m))}s.length&&(this.currentRenderTarget=s[0]),this.setShadersFromConfig(i);var T=this.shaders,v=0;for(t=0;t<T.length;t++)T[t].vertexSize>v&&(v=T[t].vertexSize);var p=o(i,"batchSize",r.config.batchSize);this.vertexCapacity=6*p;var x=new ArrayBuffer(this.vertexCapacity*v);this.vertexData=x,this.bytes=new Uint8Array(x),this.vertexViewF32=new Float32Array(x),this.vertexViewU32=new Uint32Array(x);var E=o(i,"vertices",null);for(E?(this.vertexViewF32.set(E),this.vertexBuffer=r.createVertexBuffer(x,e.STATIC_DRAW)):this.vertexBuffer=r.createVertexBuffer(x.byteLength,e.DYNAMIC_DRAW),this.setVertexBuffer(),t=T.length-1;t>=0;t--)T[t].rebind();this.hasBooted=!0,r.on(u.RESIZE,this.resize,this),r.on(u.PRE_RENDER,this.onPreRender,this),r.on(u.RENDER,this.onRender,this),r.on(u.POST_RENDER,this.onPostRender,this),this.emit(a.BOOT,this),this.onBoot()},onBoot:function(){},onResize:function(){},setShader:function(t,e){var i=this.renderer;return t===this.currentShader&&i.currentProgram===this.currentShader.program||(this.flush(),i.resetTextures(),this.setVertexBuffer()&&!e&&(e=!0),t.bind(e,!1),this.currentShader=t),this},getShaderByName:function(t){for(var e=this.shaders,i=0;i<e.length;i++)if(e[i].name===t)return e[i]},setShadersFromConfig:function(t){var e,i=this.shaders,r=this.renderer;for(e=0;e<i.length;e++)i[e].destroy();var n="vertShader",a="fragShader",h="attributes",u=o(t,n,null),l=c.parseFragmentShaderMaxTextures(o(t,a,null),r.maxTextures),d=o(t,h,null),g=o(t,"shaders",[]),m=g.length;if(0===m)u&&l&&(this.shaders=[new f(this,"default",u,l,s(d))]);else{var T=[];for(e=0;e<m;e++){var v=g[e],p=o(v,"name","default"),x=o(v,n,u),E=c.parseFragmentShaderMaxTextures(o(v,a,l),r.maxTextures),R=o(v,h,d);x&&E&&T.push(new f(this,p,x,E,s(R)))}this.shaders=T}return 0===this.shaders.length?console.warn("Pipeline: "+this.name+" - Invalid shader config"):this.currentShader=this.shaders[0],this},setGameObject:function(t,e){return void 0===e&&(e=t.frame),this.currentUnit=this.renderer.setTextureSource(e.source),this.currentUnit},shouldFlush:function(t){return void 0===t&&(t=0),this.vertexCount+t>this.vertexCapacity},resize:function(t,e){t===this.width&&e===this.height||this.flush(),this.width=t,this.height=e;for(var i=this.renderTargets,r=0;r<i.length;r++)i[r].resize(t,e);return this.setProjectionMatrix(t,e),this.emit(a.RESIZE,t,e,this),this.onResize(t,e),this},setProjectionMatrix:function(t,e){var i=this.projectionMatrix;if(!i)return this;this.projectionWidth=t,this.projectionHeight=e,i.ortho(0,t,e,0,-1e3,1e3);for(var r=this.shaders,s="uProjectionMatrix",n=0;n<r.length;n++){var a=r[n];a.hasUniform(s)&&(a.resetUniform(s),a.setMatrix4fv(s,!1,i.val,a))}return this},updateProjectionMatrix:function(){if(this.projectionMatrix){var t=this.renderer.projectionWidth,e=this.renderer.projectionHeight;this.projectionWidth===t&&this.projectionHeight===e||this.setProjectionMatrix(t,e)}},bind:function(t){if(void 0===t&&(t=this.currentShader),this.glReset)return this.rebind(t);var e=this.setVertexBuffer();return t.bind(e),this.currentShader=t,this.emit(a.BIND,this,t),this.onActive(t),this},rebind:function(t){this.setVertexBuffer();for(var e=this.shaders,i=e.length-1;i>=0;i--){var r=e[i].rebind();t&&r!==t||(this.currentShader=r)}return this.emit(a.REBIND,this.currentShader),this.onActive(this.currentShader),this.onRebind(),this.glReset=!1,this},setVertexBuffer:function(){var t=this.gl,e=this.vertexBuffer;return t.getParameter(t.ARRAY_BUFFER_BINDING)!==e&&(t.bindBuffer(t.ARRAY_BUFFER,e),!0)},preBatch:function(t){return this.currentRenderTarget&&this.currentRenderTarget.bind(),this.onPreBatch(t),this},postBatch:function(t){return this.onDraw(this.currentRenderTarget),this.onPostBatch(t),this},onDraw:function(){},unbind:function(){this.currentRenderTarget&&this.currentRenderTarget.unbind()},flush:function(t){if(void 0===t&&(t=!1),this.vertexCount>0){this.emit(a.BEFORE_FLUSH,this,t),this.onBeforeFlush(t);var e=this.gl,i=this.vertexCount,r=this.currentShader.vertexSize;this.active&&(this.setVertexBuffer(),i===this.vertexCapacity?e.bufferData(e.ARRAY_BUFFER,this.vertexData,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.bytes.subarray(0,i*r)),e.drawArrays(this.topology,0,i)),this.vertexCount=0,this.emit(a.AFTER_FLUSH,this,t),this.onAfterFlush(t)}return this},onActive:function(){},onBind:function(){},onRebind:function(){},onBatch:function(){},onPreBatch:function(){},onPostBatch:function(){},onPreRender:function(){},onRender:function(){},onPostRender:function(){},onBeforeFlush:function(){},onAfterFlush:function(){},batchVert:function(t,e,i,r,s,n,a){var o=this.vertexViewF32,h=this.vertexViewU32,u=this.vertexCount*this.currentShader.vertexComponentCount-1;o[++u]=t,o[++u]=e,o[++u]=i,o[++u]=r,o[++u]=s,o[++u]=n,h[++u]=a,this.vertexCount++},batchQuad:function(t,e,i,r,s,n,a,o,h,u,l,c,f,d,g,m,T,v,p,x){void 0===x&&(x=this.currentUnit);var E=!1;return this.shouldFlush(6)&&(this.flush(),E=!0,x=this.setTexture2D(p)),this.batchVert(e,i,u,l,x,v,d),this.batchVert(r,s,u,f,x,v,m),this.batchVert(n,a,c,f,x,v,T),this.batchVert(e,i,u,l,x,v,d),this.batchVert(n,a,c,f,x,v,T),this.batchVert(o,h,c,l,x,v,g),this.onBatch(t),E},batchTri:function(t,e,i,r,s,n,a,o,h,u,l,c,f,d,g,m,T){void 0===T&&(T=this.currentUnit);var v=!1;return this.shouldFlush(3)&&(this.flush(),v=!0,T=this.setTexture2D(m)),this.batchVert(e,i,o,h,T,g,c),this.batchVert(r,s,o,l,T,g,f),this.batchVert(n,a,u,l,T,g,d),this.onBatch(t),v},drawFillRect:function(t,e,i,r,s,n,a,o){void 0===a&&(a=this.renderer.whiteTexture.glTexture),void 0===o&&(o=!0),t=Math.floor(t),e=Math.floor(e);var h=Math.floor(t+i),u=Math.floor(e+r),l=this.setTexture2D(a),f=c.getTintAppendFloatAlphaAndSwap(s,n),d=0,g=1;o&&(d=1,g=0),this.batchQuad(null,t,e,t,u,h,u,h,e,0,d,1,g,f,f,f,f,0,a,l)},setTexture2D:function(t){return void 0===t&&(t=this.renderer.whiteTexture.glTexture),this.currentUnit=this.renderer.setTexture2D(t),this.currentUnit},bindTexture:function(t,e){void 0===e&&(e=0);var i=this.gl;return i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),this},bindRenderTarget:function(t,e){return this.bindTexture(t.texture,e)},setTime:function(t){return this.set1f(t,this.game.loop.getDuration()),this},set1f:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1f(t,e),this},set2f:function(t,e,i,r){return void 0===r&&(r=this.currentShader),r.set2f(t,e,i),this},set3f:function(t,e,i,r,s){return void 0===s&&(s=this.currentShader),s.set3f(t,e,i,r),this},set4f:function(t,e,i,r,s,n){return void 0===n&&(n=this.currentShader),n.set4f(t,e,i,r,s),this},set1fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1fv(t,e),this},set2fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set2fv(t,e),this},set3fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set3fv(t,e),this},set4fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set4fv(t,e),this},set1iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1iv(t,e),this},set2iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set2iv(t,e),this},set3iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set3iv(t,e),this},set4iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set4iv(t,e),this},set1i:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1i(t,e),this},set2i:function(t,e,i,r){return void 0===r&&(r=this.currentShader),r.set2i(t,e,i),this},set3i:function(t,e,i,r,s){return void 0===s&&(s=this.currentShader),s.set3i(t,e,i,r),this},set4i:function(t,e,i,r,s,n){return void 0===n&&(n=this.currentShader),n.set4i(t,e,i,r,s),this},setMatrix2fv:function(t,e,i,r){return void 0===r&&(r=this.currentShader),r.setMatrix2fv(t,e,i),this},setMatrix3fv:function(t,e,i,r){return void 0===r&&(r=this.currentShader),r.setMatrix3fv(t,e,i),this},setMatrix4fv:function(t,e,i,r){return void 0===r&&(r=this.currentShader),r.setMatrix4fv(t,e,i),this},destroy:function(){var t;this.emit(a.DESTROY,this);var e=this.shaders;for(t=0;t<e.length;t++)e[t].destroy();var i=this.renderTargets;for(t=0;t<i.length;t++)i[t].destroy();this.gl.deleteBuffer(this.vertexBuffer);var r=this.renderer;return r.off(u.RESIZE,this.resize,this),r.off(u.PRE_RENDER,this.onPreRender,this),r.off(u.RENDER,this.onRender,this),r.off(u.POST_RENDER,this.onPostRender,this),this.removeAllListeners(),this.game=null,this.renderer=null,this.manager=null,this.gl=null,this.view=null,this.shaders=null,this.renderTargets=null,this.bytes=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexData=null,this.vertexBuffer=null,this.currentShader=null,this.currentRenderTarget=null,this}});t.exports=d},58410:(t,e,i)=>{var r=i(63083),s=i(26088),n=i(69186),a=i(11318),o=i(26729),h=i(37710),u=i(24496),l=i(58655),c=i(54259),f=i(45733),d=i(37107),g=i(50666),m=i(48958),T=i(61632),v=i(64564),p=i(75913),x=new n({Extends:o,initialize:function(t){o.call(this);var e=t.config,i={alpha:e.transparent,desynchronized:e.desynchronized,depth:!1,antialias:e.antialiasGL,premultipliedAlpha:e.premultipliedAlpha,stencil:!0,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat,powerPreference:e.powerPreference,preserveDrawingBuffer:e.preserveDrawingBuffer};this.config={clearBeforeRender:e.clearBeforeRender,antialias:e.antialias,backgroundColor:e.backgroundColor,contextCreation:i,roundPixels:e.roundPixels,maxTextures:e.maxTextures,maxTextureSize:e.maxTextureSize,batchSize:e.batchSize,maxLights:e.maxLights,mipmapFilter:e.mipmapFilter},this.game=t,this.type=a.WEBGL,this.pipelines=null,this.width=0,this.height=0,this.canvas=t.canvas,this.blendModes=[],this.contextLost=!1,this.snapshotState={x:0,y:0,width:1,height:1,getPixel:!1,callback:null,type:"image/png",encoder:.92,isFramebuffer:!1,bufferWidth:0,bufferHeight:0},this.currentActiveTexture=0,this.startActiveTexture=0,this.maxTextures=0,this.textureIndexes,this.tempTextures,this.textureZero,this.normalTexture,this.currentFramebuffer=null,this.fboStack=[],this.currentProgram=null,this.currentBlendMode=1/0,this.currentScissorEnabled=!1,this.currentScissor=null,this.scissorStack=[],this.contextLostHandler=f,this.contextRestoredHandler=f,this.gl=null,this.supportedExtensions=null,this.instancedArraysExtension=null,this.vaoExtension=null,this.extensions={},this.glFormats=[],this.compression={ETC1:!1,PVRTC:!1,S3TC:!1},this.drawingBufferHeight=0,this.blankTexture=null,this.whiteTexture=null,this.maskCount=0,this.maskStack=[],this.currentMask={mask:null,camera:null},this.currentCameraMask={mask:null,camera:null},this.glFuncMap=null,this.currentType="",this.newType=!1,this.nextTypeMatch=!1,this.finalType=!1,this.mipmapFilter=null,this.textureFlush=0,this.isTextureClean=!1,this.defaultScissor=[0,0,0,0],this.isBooted=!1,this.renderTarget=null,this.projectionMatrix,this.projectionWidth=0,this.projectionHeight=0,this.init(this.config)},init:function(t){var e,i=this.game,r=this.canvas,s=t.backgroundColor;if(!(e=i.config.context?i.config.context:r.getContext("webgl",t.contextCreation)||r.getContext("experimental-webgl",t.contextCreation))||e.isContextLost())throw this.contextLost=!0,new Error("WebGL unsupported");this.gl=e;var n=this;this.contextLostHandler=function(t){n.contextLost=!0,n.game.events.emit(u.CONTEXT_LOST,n),t.preventDefault()},this.contextRestoredHandler=function(){n.contextLost=!1,n.init(n.config),n.game.events.emit(u.CONTEXT_RESTORED,n)},r.addEventListener("webglcontextlost",this.contextLostHandler,!1),r.addEventListener("webglcontextrestored",this.contextRestoredHandler,!1),i.context=e;for(var o=0;o<=27;o++)this.blendModes.push({func:[e.ONE,e.ONE_MINUS_SRC_ALPHA],equation:e.FUNC_ADD});this.blendModes[1].func=[e.ONE,e.DST_ALPHA],this.blendModes[2].func=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],this.blendModes[3].func=[e.ONE,e.ONE_MINUS_SRC_COLOR],this.blendModes[17]={func:[e.ZERO,e.ONE_MINUS_SRC_ALPHA],equation:e.FUNC_REVERSE_SUBTRACT},this.glFormats[0]=e.BYTE,this.glFormats[1]=e.SHORT,this.glFormats[2]=e.UNSIGNED_BYTE,this.glFormats[3]=e.UNSIGNED_SHORT,this.glFormats[4]=e.FLOAT,this.glFuncMap={mat2:{func:e.uniformMatrix2fv,length:1,matrix:!0},mat3:{func:e.uniformMatrix3fv,length:1,matrix:!0},mat4:{func:e.uniformMatrix4fv,length:1,matrix:!0},"1f":{func:e.uniform1f,length:1},"1fv":{func:e.uniform1fv,length:1},"1i":{func:e.uniform1i,length:1},"1iv":{func:e.uniform1iv,length:1},"2f":{func:e.uniform2f,length:2},"2fv":{func:e.uniform2fv,length:1},"2i":{func:e.uniform2i,length:2},"2iv":{func:e.uniform2iv,length:1},"3f":{func:e.uniform3f,length:3},"3fv":{func:e.uniform3fv,length:1},"3i":{func:e.uniform3i,length:3},"3iv":{func:e.uniform3iv,length:1},"4f":{func:e.uniform4f,length:4},"4fv":{func:e.uniform4fv,length:1},"4i":{func:e.uniform4i,length:4},"4iv":{func:e.uniform4iv,length:1}};var h=e.getSupportedExtensions();t.maxTextures&&-1!==t.maxTextures||(t.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),t.maxTextureSize||(t.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE));var l="WEBGL_compressed_texture_",f="WEBKIT_"+l;this.compression.ETC1=e.getExtension(l+"etc1")||e.getExtension(f+"etc1"),this.compression.PVRTC=e.getExtension(l+"pvrtc")||e.getExtension(f+"pvrtc"),this.compression.S3TC=e.getExtension(l+"s3tc")||e.getExtension(f+"s3tc"),this.supportedExtensions=h;var g="ANGLE_instanced_arrays";this.instancedArraysExtension=h.indexOf(g)>-1?e.getExtension(g):null;var m="OES_vertex_array_object";this.vaoExtension=h.indexOf(m)>-1?e.getExtension(m):null,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.clearColor(s.redGL,s.greenGL,s.blueGL,s.alphaGL),this.mipmapFilter=e[t.mipmapFilter],this.maxTextures=v.checkShaderMax(e,t.maxTextures),this.textureIndexes=[];var p=this.tempTextures;if(Array.isArray(p))for(var x=0;o<this.maxTextures;x++)e.deleteTexture(p[x]);else p=new Array(this.maxTextures);for(var E=0;E<this.maxTextures;E++){var R=e.createTexture();e.activeTexture(e.TEXTURE0+E),e.bindTexture(e.TEXTURE_2D,R),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),p[E]=R,this.textureIndexes.push(E)}return this.tempTextures=p,this.currentActiveTexture=1,this.startActiveTexture++,e.activeTexture(e.TEXTURE1),this.pipelines=new d(this),this.setBlendMode(a.BlendModes.NORMAL),this.projectionMatrix=(new c).identity(),i.textures.once(T.READY,this.boot,this),this},boot:function(){var t=this.game,e=this.pipelines,i=t.scale.baseSize;this.width=i.width,this.height=i.height,this.isBooted=!0,this.renderTarget=new g(this,this.width,this.height,1,0,!0,!0),e.boot(t.config.pipeline),this.blankTexture=t.textures.getFrame("__DEFAULT"),this.whiteTexture=t.textures.getFrame("__WHITE");var r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,null),r.enable(r.SCISSOR_TEST),t.scale.on(m.RESIZE,this.onResize,this),this.resize(i.width,i.height)},onResize:function(t,e){e.width===this.width&&e.height===this.height||this.resize(e.width,e.height)},beginCapture:function(t,e){void 0===t&&(t=this.width),void 0===e&&(e=this.height),this.renderTarget.bind(!0,t,e),this.setProjectionMatrix(t,e),this.resetTextures()},endCapture:function(){return this.renderTarget.unbind(!0),this.resetProjectionMatrix(),this.renderTarget},resize:function(t,e){var i=this.gl;return this.width=t,this.height=e,this.setProjectionMatrix(t,e),i.viewport(0,0,t,e),this.drawingBufferHeight=i.drawingBufferHeight,i.scissor(0,i.drawingBufferHeight-e,t,e),this.defaultScissor[2]=t,this.defaultScissor[3]=e,this.emit(h.RESIZE,t,e),this},getAspectRatio:function(){return this.width/this.height},setProjectionMatrix:function(t,e){return t===this.projectionWidth&&e===this.projectionHeight||(this.projectionWidth=t,this.projectionHeight=e,this.projectionMatrix.ortho(0,t,e,0,-1e3,1e3)),this},resetProjectionMatrix:function(){this.projectionWidth=this.width,this.projectionHeight=this.height,this.projectionMatrix.ortho(0,this.width,this.height,0,-1e3,1e3)},hasExtension:function(t){return!!this.supportedExtensions&&this.supportedExtensions.indexOf(t)},getExtension:function(t){return this.hasExtension(t)?(t in this.extensions||(this.extensions[t]=this.gl.getExtension(t)),this.extensions[t]):null},flush:function(){this.pipelines.flush()},pushScissor:function(t,e,i,r,s){void 0===s&&(s=this.drawingBufferHeight);var n=[t,e,i,r];return this.scissorStack.push(n),this.setScissor(t,e,i,r,s),this.currentScissor=n,n},setScissor:function(t,e,i,r,s){void 0===s&&(s=this.drawingBufferHeight);var n=this.gl,a=this.currentScissor,o=i>0&&r>0;if(a&&o){var h=a[0],u=a[1],l=a[2],c=a[3];o=h!==t||u!==e||l!==i||c!==r}o&&(this.flush(),n.scissor(t,s-e-r,i,r))},resetScissor:function(){var t=this.gl;t.enable(t.SCISSOR_TEST);var e=this.currentScissor;if(e){var i=e[0],r=e[1],s=e[2],n=e[3];s>0&&n>0&&t.scissor(i,this.drawingBufferHeight-r-n,s,n)}},popScissor:function(){var t=this.scissorStack;t.pop();var e=t[t.length-1];e&&this.setScissor(e[0],e[1],e[2],e[3]),this.currentScissor=e},hasActiveStencilMask:function(){var t=this.currentMask.mask,e=this.currentCameraMask.mask;return t&&t.isStencil||e&&e.isStencil},resetViewport:function(){var t=this.gl;t.viewport(0,0,this.width,this.height),this.drawingBufferHeight=t.drawingBufferHeight},setBlendMode:function(t,e){void 0===e&&(e=!1);var i=this.gl,r=this.blendModes[t];return!!(e||t!==a.BlendModes.SKIP_CHECK&&this.currentBlendMode!==t)&&(this.flush(),i.enable(i.BLEND),i.blendEquation(r.equation),r.func.length>2?i.blendFuncSeparate(r.func[0],r.func[1],r.func[2],r.func[3]):i.blendFunc(r.func[0],r.func[1]),this.currentBlendMode=t,!0)},addBlendMode:function(t,e){return this.blendModes.push({func:t,equation:e})-1},updateBlendMode:function(t,e,i){return this.blendModes[t]&&(this.blendModes[t].func=e,i&&(this.blendModes[t].equation=i)),this},removeBlendMode:function(t){return t>17&&this.blendModes[t]&&this.blendModes.splice(t,1),this},setBlankTexture:function(){this.setTexture2D(this.blankTexture.glTexture)},setTextureSource:function(t){if(this.pipelines.forceZero())return this.setTextureZero(t.glTexture,!0),0;var e=this.gl,i=this.currentActiveTexture;return t.glIndexCounter<this.startActiveTexture&&(t.glIndexCounter=this.startActiveTexture,i<this.maxTextures?(t.glIndex=i,e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture++):(this.flush(),this.startActiveTexture++,this.textureFlush++,t.glIndexCounter=this.startActiveTexture,t.glIndex=1,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture=2)),this.isTextureClean=!1,t.glIndex},isNewNormalMap:function(t,e){return this.textureZero!==t||this.normalTexture!==e},setTextureZero:function(t,e){if(this.textureZero!==t){e&&this.flush();var i=this.gl;i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t),this.textureZero=t}},clearTextureZero:function(){this.textureZero=null},setNormalMap:function(t){if(this.normalTexture!==t){var e=this.gl;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),this.normalTexture=t,1===this.currentActiveTexture&&(this.currentActiveTexture=2)}},clearNormalMap:function(){this.normalTexture=null,this.startActiveTexture++,this.currentActiveTexture=1,this.textureFlush++},unbindTextures:function(){for(var t=this.gl,e=this.tempTextures,i=0;i<e.length;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,null);this.normalTexture=null,this.textureZero=null,this.currentActiveTexture=1,this.startActiveTexture++,this.textureFlush++},resetTextures:function(t){if(void 0===t&&(t=!1),!this.isTextureClean){this.flush();var e=this.gl,i=this.tempTextures;if(t){for(var r=0;r<i.length;r++)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,i[r]);e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i[1]),this.isTextureClean=!0}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i[0]),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i[1]);this.normalTexture=null,this.textureZero=null,this.currentActiveTexture=1,this.startActiveTexture++,this.textureFlush++}},setTexture2D:function(t){if(this.pipelines.forceZero())return this.setTextureZero(t,!0),0;var e=this.gl,i=this.currentActiveTexture;return t.glIndexCounter<this.startActiveTexture&&(t.glIndexCounter=this.startActiveTexture,i<this.maxTextures?(t.glIndex=i,e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,t),this.currentActiveTexture++):(this.flush(),this.startActiveTexture++,this.textureFlush++,t.glIndexCounter=this.startActiveTexture,t.glIndex=1,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),this.currentActiveTexture=2)),this.isTextureClean=!1,t.glIndex},pushFramebuffer:function(t,e,i,r){return t===this.currentFramebuffer?this:(this.fboStack.push(t),this.setFramebuffer(t,e,i,r))},setFramebuffer:function(t,e,i,r){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!0),t===this.currentFramebuffer)return this;var s=this.gl,n=this.width,a=this.height;return t&&t.renderTexture&&r?(n=t.renderTexture.width,a=t.renderTexture.height):this.flush(),s.bindFramebuffer(s.FRAMEBUFFER,t),r&&s.viewport(0,0,n,a),e&&(t?(this.drawingBufferHeight=a,this.pushScissor(0,0,n,a)):(this.drawingBufferHeight=this.height,this.popScissor())),this.currentFramebuffer=t,i&&this.resetTextures(),this},popFramebuffer:function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!0);var r=this.fboStack;r.pop();var s=r[r.length-1];return s||(s=null),this.setFramebuffer(s,t,e,i),s},setProgram:function(t){return t!==this.currentProgram&&(this.flush(),this.gl.useProgram(t),this.currentProgram=t,!0)},resetProgram:function(){return this.gl.useProgram(this.currentProgram),this},createTextureFromSource:function(t,e,i,r){var s=this.gl,n=s.NEAREST,o=s.NEAREST,h=s.CLAMP_TO_EDGE;e=t?t.width:e,i=t?t.height:i;var u=l(e,i);return u&&(h=s.REPEAT),r===a.ScaleModes.LINEAR&&this.config.antialias&&(n=u?this.mipmapFilter:s.LINEAR,o=s.LINEAR),t||"number"!=typeof e||"number"!=typeof i?this.createTexture2D(0,n,o,h,h,s.RGBA,t):this.createTexture2D(0,n,o,h,h,s.RGBA,null,e,i)},createTexture2D:function(t,e,i,r,s,n,a,o,h,u,c,f){u=null==u||u,void 0===c&&(c=!1),void 0===f&&(f=!1);var d=this.gl,g=d.createTexture();d.activeTexture(d.TEXTURE0);var m=d.getParameter(d.TEXTURE_BINDING_2D);return d.bindTexture(d.TEXTURE_2D,g),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,f),null==a?d.texImage2D(d.TEXTURE_2D,t,n,o,h,0,n,d.UNSIGNED_BYTE,null):(c||(o=a.width,h=a.height),d.texImage2D(d.TEXTURE_2D,t,n,n,d.UNSIGNED_BYTE,a)),l(o,h)&&d.generateMipmap(d.TEXTURE_2D),m&&d.bindTexture(d.TEXTURE_2D,m),g.isAlphaPremultiplied=u,g.isRenderTexture=!1,g.width=o,g.height=h,g.glIndex=0,g.glIndexCounter=-1,g},createFramebuffer:function(t,e,i,r){var s,n=this.gl,a=n.createFramebuffer();if(this.setFramebuffer(a),r){var o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,e),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}if(i.isRenderTexture=!0,i.isAlphaPremultiplied=!1,n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0),(s=n.checkFramebufferStatus(n.FRAMEBUFFER))!==n.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer status: "+{36054:"Incomplete Attachment",36055:"Missing Attachment",36057:"Incomplete Dimensions",36061:"Framebuffer Unsupported"}[s]);return a.renderTexture=i,this.setFramebuffer(null),this.resetTextures(),a},createProgram:function(t,e){var i=this.gl,r=i.createProgram(),s=i.createShader(i.VERTEX_SHADER),n=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(s,t),i.shaderSource(n,e),i.compileShader(s),i.compileShader(n),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error("Vertex Shader failed:\n"+i.getShaderInfoLog(s));if(!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error("Fragment Shader failed:\n"+i.getShaderInfoLog(n));if(i.attachShader(r,s),i.attachShader(r,n),i.linkProgram(r),!i.getProgramParameter(r,i.LINK_STATUS))throw new Error("Link Program failed:\n"+i.getProgramInfoLog(r));return i.useProgram(r),r},createVertexBuffer:function(t,e){var i=this.gl,r=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null),r},createIndexBuffer:function(t,e){var i=this.gl,r=i.createBuffer();return i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,e),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),r},deleteTexture:function(t,e){return e&&this.resetTextures(!0),t&&this.gl.deleteTexture(t),this},deleteFramebuffer:function(t){return t&&(this.gl.deleteFramebuffer(t),r(this.fboStack,t),this.currentFramebuffer===t&&(this.currentFramebuffer=null)),this},deleteProgram:function(t){return t&&this.gl.deleteProgram(t),this},deleteBuffer:function(t){return this.gl.deleteBuffer(t),this},preRenderCamera:function(t){var e=t.x,i=t.y,r=t.width,n=t.height,a=t.backgroundColor;t.emit(s.PRE_RENDER,t),this.pipelines.preBatchCamera(t),this.pushScissor(e,i,r,n),t.mask&&(this.currentCameraMask.mask=t.mask,this.currentCameraMask.camera=t._maskCamera,t.mask.preRenderWebGL(this,t,t._maskCamera)),a.alphaGL>0&&this.pipelines.setMulti().drawFillRect(e,i,r,n,v.getTintFromFloats(a.blueGL,a.greenGL,a.redGL,1),a.alphaGL)},getCurrentStencilMask:function(){var t=null,e=this.maskStack,i=this.currentCameraMask;return e.length>0?t=e[e.length-1]:i.mask&&i.mask.isStencil&&(t=i),t},postRenderCamera:function(t){var e=t.flashEffect,i=t.fadeEffect;if(e.isRunning||i.isRunning||i.isComplete){var r=this.pipelines.setMulti();e.postRenderWebGL(r,v.getTintFromFloats),i.postRenderWebGL(r,v.getTintFromFloats)}t.dirty=!1,this.popScissor(),t.mask&&(this.currentCameraMask.mask=null,t.mask.postRenderWebGL(this,t._maskCamera)),this.pipelines.postBatchCamera(t),t.emit(s.POST_RENDER,t)},preRender:function(){if(!this.contextLost){var t=this.gl;if(t.bindFramebuffer(t.FRAMEBUFFER,null),this.config.clearBeforeRender){var e=this.config.backgroundColor;t.clearColor(e.redGL,e.greenGL,e.blueGL,e.alphaGL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}t.enable(t.SCISSOR_TEST),this.currentScissor=this.defaultScissor,this.scissorStack.length=0,this.scissorStack.push(this.currentScissor),this.game.scene.customViewports&&t.scissor(0,this.drawingBufferHeight-this.height,this.width,this.height),this.currentMask.mask=null,this.currentCameraMask.mask=null,this.maskStack.length=0,this.textureFlush=0,this.emit(h.PRE_RENDER)}},render:function(t,e,i){if(!this.contextLost){var r=e.length;if(this.emit(h.RENDER,t,i),this.preRenderCamera(i),0===r)return this.setBlendMode(a.BlendModes.NORMAL),void this.postRenderCamera(i);this.currentType="";for(var s=this.currentMask,n=0;n<r;n++){this.finalType=n===r-1;var o=e[n],u=o.mask;(s=this.currentMask).mask&&s.mask!==u&&s.mask.postRenderWebGL(this,s.camera),u&&s.mask!==u&&u.preRenderWebGL(this,o,i),o.blendMode!==this.currentBlendMode&&this.setBlendMode(o.blendMode);var l=o.type;l!==this.currentType&&(this.newType=!0,this.currentType=l),this.finalType?this.nextTypeMatch=!1:this.nextTypeMatch=e[n+1].type===this.currentType,o.renderWebGL(this,o,i),this.newType=!1}(s=this.currentMask).mask&&s.mask.postRenderWebGL(this,s.camera),this.setBlendMode(a.BlendModes.NORMAL),this.postRenderCamera(i)}},postRender:function(){if(!this.contextLost){this.flush(),this.emit(h.POST_RENDER);var t=this.snapshotState;t.callback&&(p(this.canvas,t),t.callback=null),this.textureFlush>0&&(this.startActiveTexture++,this.currentActiveTexture=1)}},snapshot:function(t,e,i){return this.snapshotArea(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight,t,e,i)},snapshotArea:function(t,e,i,r,s,n,a){var o=this.snapshotState;return o.callback=s,o.type=n,o.encoder=a,o.getPixel=!1,o.x=t,o.y=e,o.width=Math.min(i,this.gl.drawingBufferWidth),o.height=Math.min(r,this.gl.drawingBufferHeight),this},snapshotPixel:function(t,e,i){return this.snapshotArea(t,e,1,1,i),this.snapshotState.getPixel=!0,this},snapshotFramebuffer:function(t,e,i,r,s,n,a,o,h,u,l){void 0===s&&(s=!1),void 0===n&&(n=0),void 0===a&&(a=0),void 0===o&&(o=e),void 0===h&&(h=i);var c=this.currentFramebuffer;this.snapshotArea(n,a,o,h,r,u,l);var f=this.snapshotState;return f.getPixel=s,f.isFramebuffer=!0,f.bufferWidth=e,f.bufferHeight=i,this.setFramebuffer(t),p(this.canvas,f),this.setFramebuffer(c),f.callback=null,f.isFramebuffer=!1,this},canvasToTexture:function(t,e,i,r){return void 0===i&&(i=!1),void 0===r&&(r=!1),e?this.updateCanvasTexture(t,e,r):this.createCanvasTexture(t,i,r)},createCanvasTexture:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var r=this.gl,s=r.NEAREST,n=r.NEAREST,a=t.width,o=t.height,h=r.CLAMP_TO_EDGE,u=l(a,o);return!e&&u&&(h=r.REPEAT),this.config.antialias&&(s=u?this.mipmapFilter:r.LINEAR,n=r.LINEAR),this.createTexture2D(0,s,n,h,h,r.RGBA,t,a,o,!0,!1,i)},updateCanvasTexture:function(t,e,i){void 0===i&&(i=!1);var r=this.gl,s=t.width,n=t.height;if(s>0&&n>0){r.activeTexture(r.TEXTURE0);var a=r.getParameter(r.TEXTURE_BINDING_2D);r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),e.width=s,e.height=n,a&&r.bindTexture(r.TEXTURE_2D,a)}return e},createVideoTexture:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var r=this.gl,s=r.NEAREST,n=r.NEAREST,a=t.videoWidth,o=t.videoHeight,h=r.CLAMP_TO_EDGE,u=l(a,o);return!e&&u&&(h=r.REPEAT),this.config.antialias&&(s=u?this.mipmapFilter:r.LINEAR,n=r.LINEAR),this.createTexture2D(0,s,n,h,h,r.RGBA,t,a,o,!0,!0,i)},updateVideoTexture:function(t,e,i){void 0===i&&(i=!1);var r=this.gl,s=t.videoWidth,n=t.videoHeight;if(s>0&&n>0){r.activeTexture(r.TEXTURE0);var a=r.getParameter(r.TEXTURE_BINDING_2D);r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),e.width=s,e.height=n,a&&r.bindTexture(r.TEXTURE_2D,a)}return e},setTextureFilter:function(t,e){var i=this.gl,r=[i.LINEAR,i.NEAREST][e];i.activeTexture(i.TEXTURE0);var s=i.getParameter(i.TEXTURE_BINDING_2D);return i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r),s&&i.bindTexture(i.TEXTURE_2D,s),this},getMaxTextureSize:function(){return this.config.maxTextureSize},destroy:function(){this.canvas.removeEventListener("webglcontextlost",this.contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredHandler,!1);for(var t=this.gl,e=this.tempTextures,i=0;i<e.length;i++)t.deleteTexture(e[i]);this.pipelines.destroy(),this.removeAllListeners(),this.fboStack=[],this.maskStack=[],this.extensions={},this.textureIndexes=[],this.gl=null,this.game=null,this.canvas=null,this.contextLost=!0,this.currentMask=null,this.currentCameraMask=null}});t.exports=x},86384:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(51303),a=new r({initialize:function(t,e,i,r,s){this.pipeline=t,this.name=e,this.renderer=t.renderer,this.gl=this.renderer.gl,this.program=this.renderer.createProgram(i,r),this.attributes,this.vertexComponentCount=0,this.vertexSize=0,this.uniforms={},this.createAttributes(s),this.createUniforms()},createAttributes:function(t){var e=0,i=0,r=[];this.vertexComponentCount=0;for(var a=0;a<t.length;a++){var o=t[a],h=o.name,u=s(o,"size",1),l=s(o,"type",n.FLOAT),c=l.enum,f=l.size,d=!!o.normalized;r.push({name:h,size:u,type:c,normalized:d,offset:i,enabled:!1,location:-1}),4===f?e+=u:e++,i+=u*f}this.vertexSize=i,this.vertexComponentCount=e,this.attributes=r},bind:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),e&&this.pipeline.flush(),this.renderer.setProgram(this.program),t&&this.setAttribPointers(),this},rebind:function(){return this.renderer.setProgram(this.program),this.setAttribPointers(!0),this},setAttribPointers:function(t){void 0===t&&(t=!1);for(var e=this.gl,i=this.vertexSize,r=this.attributes,s=this.program,n=0;n<r.length;n++){var a=r[n],o=a.size,h=a.type,u=a.offset,l=a.enabled,c=a.location,f=!!a.normalized;if(t){var d=e.getAttribLocation(s,a.name);d>=0?(e.enableVertexAttribArray(d),e.vertexAttribPointer(d,o,h,f,i,u),a.enabled=!0,a.location=d):-1!==d&&e.disableVertexAttribArray(d)}else l?e.vertexAttribPointer(c,o,h,f,i,u):!l&&c>-1&&(e.disableVertexAttribArray(c),a.location=-1)}return this},createUniforms:function(){var t,e,i,r=this.gl,s=this.program,n=this.uniforms,a=r.getProgramParameter(s,r.ACTIVE_UNIFORMS);for(t=0;t<a;t++){var o=r.getActiveUniform(s,t);if(o){e=o.name,null!==(i=r.getUniformLocation(s,e))&&(n[e]={name:e,location:i,value1:null,value2:null,value3:null,value4:null});var h=e.indexOf("[");h>0&&(e=e.substr(0,h),n.hasOwnProperty(e)||null!==(i=r.getUniformLocation(s,e))&&(n[e]={name:e,location:i,value1:null,value2:null,value3:null,value4:null}))}}return this},hasUniform:function(t){return this.uniforms.hasOwnProperty(t)},resetUniform:function(t){var e=this.uniforms[t];return e&&(e.value1=null,e.value2=null,e.value3=null,e.value4=null),this},setUniform1:function(t,e,i,r){var s=this.uniforms[e];return s?((r||s.value1!==i)&&(s.value1=i,this.renderer.setProgram(this.program),t.call(this.gl,s.location,i),this.pipeline.currentShader=this),this):this},setUniform2:function(t,e,i,r,s){var n=this.uniforms[e];return n?((s||n.value1!==i||n.value2!==r)&&(n.value1=i,n.value2=r,this.renderer.setProgram(this.program),t.call(this.gl,n.location,i,r),this.pipeline.currentShader=this),this):this},setUniform3:function(t,e,i,r,s,n){var a=this.uniforms[e];return a?((n||a.value1!==i||a.value2!==r||a.value3!==s)&&(a.value1=i,a.value2=r,a.value3=s,this.renderer.setProgram(this.program),t.call(this.gl,a.location,i,r,s),this.pipeline.currentShader=this),this):this},setUniform4:function(t,e,i,r,s,n,a){var o=this.uniforms[e];return o?((a||o.value1!==i||o.value2!==r||o.value3!==s||o.value4!==n)&&(o.value1=i,o.value2=r,o.value3=s,o.value4=n,this.renderer.setProgram(this.program),t.call(this.gl,o.location,i,r,s,n),this.pipeline.currentShader=this),this):this},set1f:function(t,e){return this.setUniform1(this.gl.uniform1f,t,e)},set2f:function(t,e,i){return this.setUniform2(this.gl.uniform2f,t,e,i)},set3f:function(t,e,i,r){return this.setUniform3(this.gl.uniform3f,t,e,i,r)},set4f:function(t,e,i,r,s){return this.setUniform4(this.gl.uniform4f,t,e,i,r,s)},set1fv:function(t,e){return this.setUniform1(this.gl.uniform1fv,t,e,!0)},set2fv:function(t,e){return this.setUniform1(this.gl.uniform2fv,t,e,!0)},set3fv:function(t,e){return this.setUniform1(this.gl.uniform3fv,t,e,!0)},set4fv:function(t,e){return this.setUniform1(this.gl.uniform4fv,t,e,!0)},set1iv:function(t,e){return this.setUniform1(this.gl.uniform1iv,t,e,!0)},set2iv:function(t,e){return this.setUniform1(this.gl.uniform2iv,t,e,!0)},set3iv:function(t,e){return this.setUniform1(this.gl.uniform3iv,t,e,!0)},set4iv:function(t,e){return this.setUniform1(this.gl.uniform4iv,t,e,!0)},set1i:function(t,e){return this.setUniform1(this.gl.uniform1i,t,e)},set2i:function(t,e,i){return this.setUniform2(this.gl.uniform2i,t,e,i)},set3i:function(t,e,i,r){return this.setUniform3(this.gl.uniform3i,t,e,i,r)},set4i:function(t,e,i,r,s){return this.setUniform4(this.gl.uniform4i,t,e,i,r,s)},setMatrix2fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix2fv,t,e,i,!0)},setMatrix3fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix3fv,t,e,i,!0)},setMatrix4fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix4fv,t,e,i,!0)},destroy:function(){this.gl.deleteProgram(this.program),this.pipeline=null,this.renderer=null,this.gl=null,this.program=null,this.attributes=null,this.uniforms=null}});t.exports=a},51303:t=>{t.exports={BYTE:{enum:5120,size:1},UNSIGNED_BYTE:{enum:5121,size:1},SHORT:{enum:5122,size:2},UNSIGNED_SHORT:{enum:5123,size:2},INT:{enum:5124,size:4},UNSIGNED_INT:{enum:5125,size:4},FLOAT:{enum:5126,size:4}}},18923:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(91160),a=i(29874),o=i(51303),h=i(89262),u=new r({Extends:h,initialize:function(t){t.fragShader=s(t,"fragShader",n),t.vertShader=s(t,"vertShader",a),t.batchSize=s(t,"batchSize",1),t.vertices=s(t,"vertices",[-1,1,-1,-7,7,1]),t.attributes=s(t,"attributes",[{name:"inPosition",size:2,type:o.FLOAT}]),h.call(this,t)},boot:function(){h.prototype.boot.call(this),this.set1i("uMainSampler",0),this.set1i("uMaskSampler",1)},resize:function(t,e){h.prototype.resize.call(this,t,e),this.set2f("uResolution",t,e)},beginMask:function(t,e,i){var r=this.gl;if(t.bitmapMask&&r){var s=this.renderer;s.flush(),s.pushFramebuffer(t.mainFramebuffer),r.disable(r.STENCIL_TEST),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),s.currentCameraMask.mask!==t&&(s.currentMask.mask=t,s.currentMask.camera=i)}},endMask:function(t,e){var i=this.gl,r=this.renderer,s=t.bitmapMask;if(s&&i){r.flush(),r.pushFramebuffer(t.maskFramebuffer),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),r.setBlendMode(0,!0),s.renderWebGL(r,s,e),r.flush(),r.popFramebuffer(),r.popFramebuffer();var n=r.getCurrentStencilMask();n?(i.enable(i.STENCIL_TEST),n.mask.applyStencil(r,n.camera,!0)):r.currentMask.mask=null,r.pipelines.set(this),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t.maskTexture),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.mainTexture),this.set1i("uInvertMaskAlpha",t.invertAlpha),i.drawArrays(this.topology,0,3),r.resetTextures()}}});t.exports=u},48623:(t,e,i)=>{var r=i(69186),s=i(64634),n=i(25738),a=i(79268),o=i(16575),h=i(9329),u=i(51303),l=i(89262),c=new r({Extends:l,initialize:function(t){t.fragShader=n(t,"fragShader",a),t.vertShader=n(t,"vertShader",o),t.attributes=n(t,"attributes",[{name:"inPosition",size:2},{name:"inColor",size:4,type:u.UNSIGNED_BYTE,normalized:!0}]),l.call(this,t),this.calcMatrix=new h,this.tempTriangle=[{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0}],this.strokeTint={TL:0,TR:0,BL:0,BR:0},this.fillTint={TL:0,TR:0,BL:0,BR:0},this.currentFrame={u0:0,v0:0,u1:1,v1:1},this.firstQuad=[0,0,0,0,0],this.prevQuad=[0,0,0,0,0],this.polygonCache=[]},batchFillRect:function(t,e,i,r,s,n){this.renderer.pipelines.set(this);var a=this.calcMatrix;n&&n.multiply(s,a);var o=t+i,h=e+r,u=a.getX(t,e),l=a.getY(t,e),c=a.getX(t,h),f=a.getY(t,h),d=a.getX(o,h),g=a.getY(o,h),m=a.getX(o,e),T=a.getY(o,e),v=this.fillTint;this.batchQuad(u,l,c,f,d,g,m,T,v.TL,v.TR,v.BL,v.BR)},batchFillTriangle:function(t,e,i,r,s,n,a,o){this.renderer.pipelines.set(this);var h=this.calcMatrix;o&&o.multiply(a,h);var u=h.getX(t,e),l=h.getY(t,e),c=h.getX(i,r),f=h.getY(i,r),d=h.getX(s,n),g=h.getY(s,n),m=this.fillTint;this.batchTri(u,l,c,f,d,g,m.TL,m.TR,m.BL)},batchStrokeTriangle:function(t,e,i,r,s,n,a,o,h){var u=this.tempTriangle;u[0].x=t,u[0].y=e,u[0].width=a,u[1].x=i,u[1].y=r,u[1].width=a,u[2].x=s,u[2].y=n,u[2].width=a,u[3].x=t,u[3].y=e,u[3].width=a,this.batchStrokePath(u,a,!1,o,h)},batchFillPath:function(t,e,i){this.renderer.pipelines.set(this);var r=this.calcMatrix;i&&i.multiply(e,r);for(var n,a,o=t.length,h=this.polygonCache,u=this.fillTint.TL,l=this.fillTint.TR,c=this.fillTint.BL,f=0;f<o;++f)a=t[f],h.push(a.x,a.y);o=(n=s(h)).length;for(var d=0;d<o;d+=3){var g=2*n[d+0],m=2*n[d+1],T=2*n[d+2],v=h[g+0],p=h[g+1],x=h[m+0],E=h[m+1],R=h[T+0],b=h[T+1],S=r.getX(v,p),A=r.getY(v,p),_=r.getX(x,E),C=r.getY(x,E),F=r.getX(R,b),M=r.getY(R,b);this.batchTri(S,A,_,C,F,M,u,l,c)}h.length=0},batchStrokePath:function(t,e,i,r,s){this.renderer.pipelines.set(this),this.prevQuad[4]=0,this.firstQuad[4]=0;for(var n=t.length-1,a=0;a<n;a++){var o=t[a],h=t[a+1];this.batchLine(o.x,o.y,h.x,h.y,o.width/2,h.width/2,e,a,!i&&a===n-1,r,s)}},batchLine:function(t,e,i,r,s,n,a,o,h,u,l){this.renderer.pipelines.set(this);var c=this.calcMatrix;l&&l.multiply(u,c);var f=i-t,d=r-e,g=Math.sqrt(f*f+d*d),m=s*(r-e)/g,T=s*(t-i)/g,v=n*(r-e)/g,p=n*(t-i)/g,x=i-v,E=r-p,R=t-m,b=e-T,S=i+v,A=r+p,_=t+m,C=e+T,F=c.getX(x,E),M=c.getY(x,E),P=c.getX(R,b),I=c.getY(R,b),L=c.getX(S,A),U=c.getY(S,A),y=c.getX(_,C),B=c.getY(_,C),D=this.strokeTint,N=D.TL,w=D.TR,X=D.BL,O=D.BR;if(this.batchQuad(y,B,P,I,F,M,L,U,N,w,X,O),!(a<=2)){var k=this.prevQuad,Y=this.firstQuad;o>0&&k[4]?this.batchQuad(y,B,P,I,k[0],k[1],k[2],k[3],N,w,X,O):(Y[0]=y,Y[1]=B,Y[2]=P,Y[3]=I,Y[4]=1),h&&Y[4]?this.batchQuad(F,M,L,U,Y[0],Y[1],Y[2],Y[3],N,w,X,O):(k[0]=F,k[1]=M,k[2]=L,k[3]=U,k[4]=1)}},batchVert:function(t,e,i){var r=this.vertexViewF32,s=this.vertexViewU32,n=this.vertexCount*this.currentShader.vertexComponentCount-1;r[++n]=t,r[++n]=e,s[++n]=i,this.vertexCount++},batchQuad:function(t,e,i,r,s,n,a,o,h,u,l,c){var f=!1;return this.shouldFlush(6)&&(this.flush(),f=!0),this.batchVert(t,e,h),this.batchVert(i,r,l),this.batchVert(s,n,c),this.batchVert(t,e,h),this.batchVert(s,n,c),this.batchVert(a,o,u),f},batchTri:function(t,e,i,r,s,n,a,o,h){var u=!1;return this.shouldFlush(3)&&(this.flush(),u=!0),this.batchVert(t,e,a),this.batchVert(i,r,o),this.batchVert(s,n,h),u},destroy:function(){return l.prototype.destroy.call(this),this.polygonCache=null,this}});t.exports=c},63174:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(80376),a=i(14869),o=i(17321),h=i(89262),u=10,l=new o,c=new r({Extends:a,initialize:function(t){u=t.game.renderer.config.maxLights;for(var e=s(t,"fragShader",n),i=[],r=1;r<=u;r++)i.push({name:"lights"+r,fragShader:e.replace("%LIGHT_COUNT%",r.toString())});t.shaders=i,a.call(this,t),this.inverseRotationMatrix=new Float32Array([1,0,0,0,1,0,0,0,1]),this.defaultNormalMap,this.lightsActive=!0},boot:function(){h.prototype.boot.call(this);var t=this.gl,e=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([127,127,255,255])),this.defaultNormalMap={glTexture:e};for(var i=0;i<this.shaders.length;i++)this["lightShader"+(i+1)]=this.shaders[i]},onRender:function(t,e){var i=t.sys.lights;if(this.lightsActive=!1,i&&i.active){var r=i.getLights(e),s=r.length;if(0!==s){var n;this.lightsActive=!0,this.setShader(this["lightShader"+s],!0);var a=this.renderer.height,o=e.matrix;for(this.set1i("uMainSampler",0),this.set1i("uNormSampler",1),this.set2f("uResolution",this.width/2,this.height/2),this.set4f("uCamera",e.x,e.y,e.rotation,e.zoom),this.set3f("uAmbientLightColor",i.ambientColor.r,i.ambientColor.g,i.ambientColor.b),n=0;n<s;n++){var h=r[n].light,u=h.color,c="uLights["+n+"].";o.transformPoint(h.x,h.y,l),this.set2f(c+"position",l.x-e.scrollX*h.scrollFactorX*e.zoom,a-(l.y-e.scrollY*h.scrollFactorY*e.zoom)),this.set3f(c+"color",u.r,u.g,u.b),this.set1f(c+"intensity",h.intensity),this.set1f(c+"radius",h.radius)}this.currentNormalMapRotation=null}}},setNormalMapRotation:function(t){if(t!==this.currentNormalMapRotation||0===this.vertexCount){this.vertexCount>0&&this.flush();var e=this.inverseRotationMatrix;if(t){var i=-t,r=Math.cos(i),s=Math.sin(i);e[1]=s,e[3]=-s,e[0]=e[4]=r}else e[0]=e[4]=1,e[1]=e[3]=0;this.setMatrix3fv("uInverseRotationMatrix",!1,e),this.currentNormalMapRotation=t}},setTexture2D:function(t,e){var i=this.renderer;void 0===t&&(t=i.tempTextures[0]);var r=this.getNormalMap(e);i.isNewNormalMap(t,r)&&(this.flush(),i.setTextureZero(t),i.setNormalMap(r));var s=e?e.rotation:0;return this.setNormalMapRotation(s),this.currentUnit=0,0},setGameObject:function(t,e){void 0===e&&(e=t.frame);var i=this.renderer,r=e.glTexture,s=this.getNormalMap(t);return i.isNewNormalMap()&&(this.flush(),i.setTextureZero(r),i.setNormalMap(s)),this.setNormalMapRotation(t.rotation),this.currentUnit=0,0},getNormalMap:function(t){var e;return t?t.displayTexture?e=t.displayTexture.dataSource[t.displayFrame.sourceIndex]:t.texture?e=t.texture.dataSource[t.frame.sourceIndex]:t.tileset&&(e=Array.isArray(t.tileset)?t.tileset[0].image.dataSource[0]:t.tileset.image.dataSource[0]):e=this.defaultNormalMap,e||(e=this.defaultNormalMap),e.glTexture},batchSprite:function(t,e,i){this.lightsActive&&a.prototype.batchSprite.call(this,t,e,i)},batchTexture:function(t,e,i,r,s,n,o,h,u,l,c,f,d,g,m,T,v,p,x,E,R,b,S,A,_,C,F,M,P,I,L,U){this.lightsActive&&a.prototype.batchTexture.call(this,t,e,i,r,s,n,o,h,u,l,c,f,d,g,m,T,v,p,x,E,R,b,S,A,_,C,F,M,P,I,L,U)},batchTextureFrame:function(t,e,i,r,s,n,o){this.lightsActive&&a.prototype.batchTextureFrame.call(this,t,e,i,r,s,n,o)}});c.LIGHT_COUNT=u,t.exports=c},14869:(t,e,i)=>{var r=i(69186),s=i(64634),n=i(25738),a=i(53121),o=i(31952),h=i(9329),u=i(64564),l=i(51303),c=i(89262),f=new r({Extends:c,initialize:function(t){var e=t.game.renderer,i=n(t,"fragShader",a);t.fragShader=u.parseFragmentShaderMaxTextures(i,e.maxTextures),t.vertShader=n(t,"vertShader",o),t.attributes=n(t,"attributes",[{name:"inPosition",size:2},{name:"inTexCoord",size:2},{name:"inTexId"},{name:"inTintEffect"},{name:"inTint",size:4,type:l.UNSIGNED_BYTE,normalized:!0}]),c.call(this,t),this._tempMatrix1=new h,this._tempMatrix2=new h,this._tempMatrix3=new h,this.calcMatrix=new h,this.tempTriangle=[{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0}],this.strokeTint={TL:0,TR:0,BL:0,BR:0},this.fillTint={TL:0,TR:0,BL:0,BR:0},this.currentFrame={u0:0,v0:0,u1:1,v1:1},this.firstQuad=[0,0,0,0,0],this.prevQuad=[0,0,0,0,0],this.polygonCache=[]},boot:function(){c.prototype.boot.call(this),this.currentShader.set1iv("uMainSampler",this.renderer.textureIndexes)},batchSprite:function(t,e,i){this.manager.set(this,t);var r=this._tempMatrix1,s=this._tempMatrix2,n=this._tempMatrix3,a=t.frame,o=a.glTexture,h=a.u0,l=a.v0,c=a.u1,f=a.v1,d=a.x,g=a.y,m=a.cutWidth,T=a.cutHeight,v=a.customPivot,p=t.displayOriginX,x=t.displayOriginY,E=-p+d,R=-x+g;if(t.isCropped){var b=t._crop;b.flipX===t.flipX&&b.flipY===t.flipY||a.updateCropUVs(b,t.flipX,t.flipY),h=b.u0,l=b.v0,c=b.u1,f=b.v1,m=b.width,T=b.height,E=-p+(d=b.x),R=-x+(g=b.y)}var S=1,A=1;t.flipX&&(v||(E+=-a.realWidth+2*p),S=-1),(t.flipY||a.source.isGLTexture&&!o.flipY)&&(v||(R+=-a.realHeight+2*x),A=-1),s.applyITRS(t.x,t.y,t.rotation,t.scaleX*S,t.scaleY*A),r.copyFrom(e.matrix),i?(r.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),s.e=t.x,s.f=t.y):(s.e-=e.scrollX*t.scrollFactorX,s.f-=e.scrollY*t.scrollFactorY),r.multiply(s,n);var _=E+m,C=R+T,F=e.roundPixels,M=n.getXRound(E,R,F),P=n.getYRound(E,R,F),I=n.getXRound(E,C,F),L=n.getYRound(E,C,F),U=n.getXRound(_,C,F),y=n.getYRound(_,C,F),B=n.getXRound(_,R,F),D=n.getYRound(_,R,F),N=u.getTintAppendFloatAlpha,w=e.alpha,X=N(t.tintTopLeft,w*t._alphaTL),O=N(t.tintTopRight,w*t._alphaTR),k=N(t.tintBottomLeft,w*t._alphaBL),Y=N(t.tintBottomRight,w*t._alphaBR);this.shouldFlush(6)&&this.flush();var H=this.setGameObject(t,a);this.manager.preBatch(t),this.batchQuad(t,M,P,I,L,U,y,B,D,h,l,c,f,X,O,k,Y,t.tintFill,o,H),this.manager.postBatch(t)},batchTexture:function(t,e,i,r,s,n,a,o,h,u,l,c,f,d,g,m,T,v,p,x,E,R,b,S,A,_,C,F,M,P,I,L){this.manager.set(this,t);var U=this._tempMatrix1,y=this._tempMatrix2,B=this._tempMatrix3,D=v/i+C,N=p/r+F,w=(v+x)/i+C,X=(p+E)/r+F,O=a,k=o,Y=-m,H=-T;if(t.isCropped){var G=t._crop,z=G.width,V=G.height;O=z,k=V,a=z,o=V;var j=v=G.x,W=p=G.y;c&&(j=x-G.x-z),f&&(W=E-G.y-V),D=j/i+C,N=W/r+F,w=(j+z)/i+C,X=(W+V)/r+F,Y=-m+v,H=-T+p}c&&(O*=-1,Y+=a),(f^=!I&&e.isRenderTexture?1:0)&&(k*=-1,H+=o);var Z=Y+O,Q=H+k;y.applyITRS(s,n,l,h,u),U.copyFrom(M.matrix),P?(U.multiplyWithOffset(P,-M.scrollX*d,-M.scrollY*g),y.e=s,y.f=n):(y.e-=M.scrollX*d,y.f-=M.scrollY*g),U.multiply(y,B);var K=M.roundPixels,q=B.getXRound(Y,H,K),J=B.getYRound(Y,H,K),$=B.getXRound(Y,Q,K),tt=B.getYRound(Y,Q,K),et=B.getXRound(Z,Q,K),it=B.getYRound(Z,Q,K),rt=B.getXRound(Z,H,K),st=B.getYRound(Z,H,K);void 0===L&&(L=this.renderer.setTexture2D(e)),t&&this.manager.preBatch(t),this.batchQuad(t,q,J,$,tt,et,it,rt,st,D,N,w,X,R,b,S,A,_,e,L),t&&this.manager.postBatch(t)},batchTextureFrame:function(t,e,i,r,s,n,a){this.manager.set(this);var o=this._tempMatrix1.copyFrom(n),h=this._tempMatrix2,l=e+t.width,c=i+t.height;a?o.multiply(a,h):h=o;var f=h.getX(e,i),d=h.getY(e,i),g=h.getX(e,c),m=h.getY(e,c),T=h.getX(l,c),v=h.getY(l,c),p=h.getX(l,i),x=h.getY(l,i),E=this.renderer.setTextureSource(t.source);r=u.getTintAppendFloatAlpha(r,s),this.batchQuad(null,f,d,g,m,T,v,p,x,t.u0,t.v0,t.u1,t.v1,r,r,r,r,0,t.glTexture,E)},batchFillRect:function(t,e,i,r,s,n){this.renderer.pipelines.set(this);var a=this.calcMatrix;n&&n.multiply(s,a);var o=t+i,h=e+r,u=a.getX(t,e),l=a.getY(t,e),c=a.getX(t,h),f=a.getY(t,h),d=a.getX(o,h),g=a.getY(o,h),m=a.getX(o,e),T=a.getY(o,e),v=this.fillTint;this.batchQuad(null,u,l,c,f,d,g,m,T,0,0,1,1,v.TL,v.TR,v.BL,v.BR,2)},batchFillTriangle:function(t,e,i,r,s,n,a,o){this.renderer.pipelines.set(this);var h=this.calcMatrix;o&&o.multiply(a,h);var u=h.getX(t,e),l=h.getY(t,e),c=h.getX(i,r),f=h.getY(i,r),d=h.getX(s,n),g=h.getY(s,n),m=this.fillTint;this.batchTri(null,u,l,c,f,d,g,0,0,1,1,m.TL,m.TR,m.BL,2)},batchStrokeTriangle:function(t,e,i,r,s,n,a,o,h){var u=this.tempTriangle;u[0].x=t,u[0].y=e,u[0].width=a,u[1].x=i,u[1].y=r,u[1].width=a,u[2].x=s,u[2].y=n,u[2].width=a,u[3].x=t,u[3].y=e,u[3].width=a,this.batchStrokePath(u,a,!1,o,h)},batchFillPath:function(t,e,i){this.renderer.pipelines.set(this);var r=this.calcMatrix;i&&i.multiply(e,r);for(var n,a,o=t.length,h=this.polygonCache,u=this.fillTint.TL,l=this.fillTint.TR,c=this.fillTint.BL,f=0;f<o;++f)a=t[f],h.push(a.x,a.y);o=(n=s(h)).length;for(var d=0;d<o;d+=3){var g=2*n[d+0],m=2*n[d+1],T=2*n[d+2],v=h[g+0],p=h[g+1],x=h[m+0],E=h[m+1],R=h[T+0],b=h[T+1],S=r.getX(v,p),A=r.getY(v,p),_=r.getX(x,E),C=r.getY(x,E),F=r.getX(R,b),M=r.getY(R,b);this.batchTri(null,S,A,_,C,F,M,0,0,1,1,u,l,c,2)}h.length=0},batchStrokePath:function(t,e,i,r,s){this.renderer.pipelines.set(this),this.prevQuad[4]=0,this.firstQuad[4]=0;for(var n=t.length-1,a=0;a<n;a++){var o=t[a],h=t[a+1];this.batchLine(o.x,o.y,h.x,h.y,o.width/2,h.width/2,e,a,!i&&a===n-1,r,s)}},batchLine:function(t,e,i,r,s,n,a,o,h,u,l){this.renderer.pipelines.set(this);var c=this.calcMatrix;l&&l.multiply(u,c);var f=i-t,d=r-e,g=Math.sqrt(f*f+d*d),m=s*(r-e)/g,T=s*(t-i)/g,v=n*(r-e)/g,p=n*(t-i)/g,x=i-v,E=r-p,R=t-m,b=e-T,S=i+v,A=r+p,_=t+m,C=e+T,F=c.getX(x,E),M=c.getY(x,E),P=c.getX(R,b),I=c.getY(R,b),L=c.getX(S,A),U=c.getY(S,A),y=c.getX(_,C),B=c.getY(_,C),D=this.strokeTint,N=D.TL,w=D.TR,X=D.BL,O=D.BR;if(this.batchQuad(null,y,B,P,I,F,M,L,U,0,0,1,1,N,w,X,O,2),!(a<=2)){var k=this.prevQuad,Y=this.firstQuad;o>0&&k[4]?this.batchQuad(null,y,B,P,I,k[0],k[1],k[2],k[3],0,0,1,1,N,w,X,O,2):(Y[0]=y,Y[1]=B,Y[2]=P,Y[3]=I,Y[4]=1),h&&Y[4]?this.batchQuad(null,F,M,L,U,Y[0],Y[1],Y[2],Y[3],0,0,1,1,N,w,X,O,2):(k[0]=F,k[1]=M,k[2]=L,k[3]=U,k[4]=1)}}});t.exports=f},26159:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(91101),a=i(90117),o=i(89262),h=new r({Extends:o,initialize:function(t){t.vertShader=s(t,"vertShader",a),t.fragShader=s(t,"fragShader",n),t.attributes=s(t,"attributes",[{name:"inPosition",size:2},{name:"inLightPosition",size:2},{name:"inLightRadius"},{name:"inLightAttenuation"},{name:"inLightColor",size:4}]),o.call(this,t)},onRender:function(t,e){this.set2f("uResolution",this.width,this.height),this.set1f("uCameraZoom",e.zoom)},batchPointLight:function(t,e,i,r,s,n,a,o,h,u,l,c){var f=t.color,d=t.intensity,g=t.radius,m=t.attenuation,T=f.r*d,v=f.g*d,p=f.b*d,x=e.alpha*t.alpha;this.shouldFlush(6)&&this.flush(),this.batchLightVert(i,r,l,c,g,m,T,v,p,x),this.batchLightVert(s,n,l,c,g,m,T,v,p,x),this.batchLightVert(a,o,l,c,g,m,T,v,p,x),this.batchLightVert(i,r,l,c,g,m,T,v,p,x),this.batchLightVert(a,o,l,c,g,m,T,v,p,x),this.batchLightVert(h,u,l,c,g,m,T,v,p,x)},batchLightVert:function(t,e,i,r,s,n,a,o,h,u){var l=this.vertexViewF32,c=this.vertexCount*this.currentShader.vertexComponentCount-1;l[++c]=t,l[++c]=e,l[++c]=i,l[++c]=r,l[++c]=s,l[++c]=n,l[++c]=a,l[++c]=o,l[++c]=h,l[++c]=u,this.vertexCount++}});t.exports=h},67239:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(14869),a=new r({Extends:n,initialize:function(t){t.topology=5,t.batchSize=s(t,"batchSize",256),n.call(this,t)}});t.exports=a},57434:(t,e,i)=>{var r=i(69186),s=i(25738),n=i(14869),a=i(77917),o=i(85833),h=i(89262),u=new r({Extends:n,initialize:function(t){t.fragShader=s(t,"fragShader",a),t.vertShader=s(t,"vertShader",o),t.forceZero=!0,n.call(this,t)},boot:function(){h.prototype.boot.call(this),this.set1i("uMainSampler",0)}});t.exports=u},21898:(t,e,i)=>{var r=i(7870),s=i(87626),n=i(69186),a=i(40013),o=i(86184),h=i(196),u=i(25738),l=i(4934),c=i(42193),f=i(89262),d=new n({Extends:f,initialize:function(t){t.renderTarget=u(t,"renderTarget",[{scale:1},{scale:1},{scale:.5},{scale:.5}]),t.vertShader=u(t,"vertShader",c),t.shaders=u(t,"shaders",[{name:"Copy",fragShader:h},{name:"AddBlend",fragShader:r},{name:"LinearBlend",fragShader:l},{name:"ColorMatrix",fragShader:o}]),t.attributes=u(t,"attributes",[{name:"inPosition",size:2},{name:"inTexCoord",size:2}]),t.vertices=[-1,-1,0,0,-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0],t.batchSize=1,f.call(this,t),this.colorMatrix=new a,this.copyShader,this.addShader,this.linearShader,this.colorMatrixShader,this.fullFrame1,this.fullFrame2,this.halfFrame1,this.halfFrame2},boot:function(){f.prototype.boot.call(this);var t=this.shaders,e=this.renderTargets;this.copyShader=t[0],this.addShader=t[1],this.linearShader=t[2],this.colorMatrixShader=t[3],this.fullFrame1=e[0],this.fullFrame2=e[1],this.halfFrame1=e[2],this.halfFrame2=e[3]},copyFrame:function(t,e,i,r,s){void 0===i&&(i=1),void 0===r&&(r=!0),void 0===s&&(s=!0);var n=this.gl;this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",i),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.texture),e?(n.viewport(0,0,e.width,e.height),n.bindFramebuffer(n.FRAMEBUFFER,e.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.texture,0)):n.viewport(0,0,t.width,t.height),r&&(s?n.clearColor(0,0,0,0):n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)),n.bufferData(n.ARRAY_BUFFER,this.vertexData,n.STATIC_DRAW),n.drawArrays(n.TRIANGLES,0,6),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindTexture(n.TEXTURE_2D,null)},blitFrame:function(t,e,i,r,n,a){void 0===i&&(i=1),void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===a&&(a=!1);var o=this.gl;if(this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",i),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t.texture),t.height>e.height)o.viewport(0,0,t.width,t.height),this.setTargetUVs(t,e);else{var h=e.height-t.height;o.viewport(0,h,t.width,t.height)}if(o.bindFramebuffer(o.FRAMEBUFFER,e.framebuffer),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e.texture,0),r&&(n?o.clearColor(0,0,0,0):o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT)),a){var u=this.renderer.currentBlendMode;this.renderer.setBlendMode(s.ERASE)}o.bufferData(o.ARRAY_BUFFER,this.vertexData,o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6),a&&this.renderer.setBlendMode(u),o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindTexture(o.TEXTURE_2D,null),this.resetUVs()},copyFrameRect:function(t,e,i,r,s,n,a,o){void 0===a&&(a=!0),void 0===o&&(o=!0);var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,t.framebuffer),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,t.texture,0),a&&(o?h.clearColor(0,0,0,0):h.clearColor(0,0,0,1),h.clear(h.COLOR_BUFFER_BIT)),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,e.texture),h.copyTexSubImage2D(h.TEXTURE_2D,0,0,0,i,r,s,n),h.bindFramebuffer(h.FRAMEBUFFER,null),h.bindTexture(h.TEXTURE_2D,null)},copyToGame:function(t){var e=this.gl;this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",1),this.renderer.popFramebuffer(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),e.bufferData(e.ARRAY_BUFFER,this.vertexData,e.STATIC_DRAW),e.drawArrays(e.TRIANGLES,0,6),this.renderer.resetTextures()},drawFrame:function(t,e,i,r){void 0===i&&(i=!0),void 0===r&&(r=this.colorMatrix);var s=this.gl;this.setShader(this.colorMatrixShader),this.set1i("uMainSampler",0),this.set1fv("uColorMatrix",r.getData()),this.set1f("uAlpha",r.alpha),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t.texture),e?(s.viewport(0,0,e.width,e.height),s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e.texture,0)):s.viewport(0,0,t.width,t.height),i?s.clearColor(0,0,0,0):s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),s.bufferData(s.ARRAY_BUFFER,this.vertexData,s.STATIC_DRAW),s.drawArrays(s.TRIANGLES,0,6),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindTexture(s.TEXTURE_2D,null)},blendFrames:function(t,e,i,r,s,n){void 0===r&&(r=1),void 0===s&&(s=!0),void 0===n&&(n=this.linearShader);var a=this.gl;this.setShader(n),this.set1i("uMainSampler1",0),this.set1i("uMainSampler2",1),this.set1f("uStrength",r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t.texture),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,e.texture),i?(a.bindFramebuffer(a.FRAMEBUFFER,i.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i.texture,0),a.viewport(0,0,i.width,i.height)):a.viewport(0,0,t.width,t.height),s?a.clearColor(0,0,0,0):a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT),a.bufferData(a.ARRAY_BUFFER,this.vertexData,a.STATIC_DRAW),a.drawArrays(a.TRIANGLES,0,6),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindTexture(a.TEXTURE_2D,null)},blendFramesAdditive:function(t,e,i,r,s){this.blendFrames(t,e,i,r,s,this.addShader)},clearFrame:function(t,e){void 0===e&&(e=!0);var i=this.gl;i.viewport(0,0,t.width,t.height),i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer),e?i.clearColor(0,0,0,0):i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT);var r=this.renderer.currentFramebuffer;i.bindFramebuffer(i.FRAMEBUFFER,r)},setUVs:function(t,e,i,r,s,n,a,o){var h=this.vertexViewF32;h[2]=t,h[3]=e,h[6]=i,h[7]=r,h[10]=s,h[11]=n,h[14]=t,h[15]=e,h[18]=s,h[19]=n,h[22]=a,h[23]=o},setTargetUVs:function(t,e){var i=e.height/t.height;i=i>.5?.5-(i-.5):.5-i+.5,this.setUVs(0,i,0,1+i,1,1+i,1,i)},flipX:function(){this.setUVs(1,0,1,1,0,1,0,0)},flipY:function(){this.setUVs(0,1,0,0,1,0,1,1)},resetUVs:function(){this.setUVs(0,0,0,1,1,1,1,0)}});t.exports=d},46098:t=>{t.exports={BITMAPMASK_PIPELINE:"BitmapMaskPipeline",LIGHT_PIPELINE:"Light2D",POINTLIGHT_PIPELINE:"PointLightPipeline",SINGLE_PIPELINE:"SinglePipeline",MULTI_PIPELINE:"MultiPipeline",ROPE_PIPELINE:"RopePipeline",GRAPHICS_PIPELINE:"GraphicsPipeline",POSTFX_PIPELINE:"PostFXPipeline",UTILITY_PIPELINE:"UtilityPipeline"}},85137:t=>{t.exports="pipelineafterflush"},92362:t=>{t.exports="pipelinebeforeflush"},13143:t=>{t.exports="pipelinebind"},31156:t=>{t.exports="pipelineboot"},27055:t=>{t.exports="pipelinedestroy"},47686:t=>{t.exports="pipelinerebind"},69139:t=>{t.exports="pipelineresize"},42789:(t,e,i)=>{t.exports={AFTER_FLUSH:i(85137),BEFORE_FLUSH:i(92362),BIND:i(13143),BOOT:i(31156),DESTROY:i(27055),REBIND:i(47686),RESIZE:i(69139)}},7870:t=>{t.exports=["#define SHADER_NAME PHASER_ADD_BLEND_FS","","precision mediump float;","","uniform sampler2D uMainSampler1;","uniform sampler2D uMainSampler2;","uniform float uStrength;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 frame1 = texture2D(uMainSampler1, outTexCoord);","    vec4 frame2 = texture2D(uMainSampler2, outTexCoord);","","    gl_FragColor = frame1 + frame2 * uStrength;","}",""].join("\n")},91160:t=>{t.exports=["#define SHADER_NAME PHASER_BITMAP_MASK_FS","","precision mediump float;","","uniform vec2 uResolution;","uniform sampler2D uMainSampler;","uniform sampler2D uMaskSampler;","uniform bool uInvertMaskAlpha;","","void main ()","{","    vec2 uv = gl_FragCoord.xy / uResolution;","    vec4 mainColor = texture2D(uMainSampler, uv);","    vec4 maskColor = texture2D(uMaskSampler, uv);","    float alpha = mainColor.a;","","    if (!uInvertMaskAlpha)","    {","        alpha *= (maskColor.a);","    }","    else","    {","        alpha *= (1.0 - maskColor.a);","    }","","    gl_FragColor = vec4(mainColor.rgb * alpha, alpha);","}",""].join("\n")},29874:t=>{t.exports=["#define SHADER_NAME PHASER_BITMAP_MASK_VS","","precision mediump float;","","attribute vec2 inPosition;","","void main ()","{","    gl_Position = vec4(inPosition, 0.0, 1.0);","}",""].join("\n")},86184:t=>{t.exports=["#define SHADER_NAME PHASER_COLORMATRIX_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","uniform float uColorMatrix[20];","uniform float uAlpha;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 c = texture2D(uMainSampler, outTexCoord);","","    if (uAlpha == 0.0)","    {","        gl_FragColor = c;","","        return;","    }","","    if (c.a > 0.0)","    {","        c.rgb /= c.a;","    }","","    vec4 result;","","    result.r = (uColorMatrix[0] * c.r) + (uColorMatrix[1] * c.g) + (uColorMatrix[2] * c.b) + (uColorMatrix[3] * c.a) + uColorMatrix[4];","    result.g = (uColorMatrix[5] * c.r) + (uColorMatrix[6] * c.g) + (uColorMatrix[7] * c.b) + (uColorMatrix[8] * c.a) + uColorMatrix[9];","    result.b = (uColorMatrix[10] * c.r) + (uColorMatrix[11] * c.g) + (uColorMatrix[12] * c.b) + (uColorMatrix[13] * c.a) + uColorMatrix[14];","    result.a = (uColorMatrix[15] * c.r) + (uColorMatrix[16] * c.g) + (uColorMatrix[17] * c.b) + (uColorMatrix[18] * c.a) + uColorMatrix[19];","","    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);","","    rgb *= result.a;","","    gl_FragColor = vec4(rgb, result.a);","}",""].join("\n")},196:t=>{t.exports=["#define SHADER_NAME PHASER_COPY_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","uniform float uBrightness;","","varying vec2 outTexCoord;","","void main ()","{","    gl_FragColor = texture2D(uMainSampler, outTexCoord) * uBrightness;","}",""].join("\n")},79268:t=>{t.exports=["#define SHADER_NAME PHASER_GRAPHICS_FS","","precision mediump float;","","varying vec4 outColor;","","void main ()","{","    gl_FragColor = vec4(outColor.bgr * outColor.a, outColor.a);","}",""].join("\n")},16575:t=>{t.exports=["#define SHADER_NAME PHASER_GRAPHICS_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec4 inColor;","","varying vec4 outColor;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outColor = inColor;","}",""].join("\n")},80376:t=>{t.exports=["#define SHADER_NAME PHASER_LIGHT_FS","","precision mediump float;","","struct Light","{","    vec2 position;","    vec3 color;","    float intensity;","    float radius;","};","","const int kMaxLights = %LIGHT_COUNT%;","","uniform vec4 uCamera; /* x, y, rotation, zoom */","uniform vec2 uResolution;","uniform sampler2D uMainSampler;","uniform sampler2D uNormSampler;","uniform vec3 uAmbientLightColor;","uniform Light uLights[kMaxLights];","uniform mat3 uInverseRotationMatrix;","","varying vec2 outTexCoord;","varying vec4 outTint;","","void main()","{","    vec3 finalColor = vec3(0.0, 0.0, 0.0);","    vec4 color = texture2D(uMainSampler, outTexCoord) * vec4(outTint.bgr * outTint.a, outTint.a);","    vec3 normalMap = texture2D(uNormSampler, outTexCoord).rgb;","    vec3 normal = normalize(uInverseRotationMatrix * vec3(normalMap * 2.0 - 1.0));","    vec2 res = vec2(min(uResolution.x, uResolution.y)) * uCamera.w;","","    for (int index = 0; index < kMaxLights; ++index)","    {","        Light light = uLights[index];","        vec3 lightDir = vec3((light.position.xy / res) - (gl_FragCoord.xy / res), 0.1);","        vec3 lightNormal = normalize(lightDir);","        float distToSurf = length(lightDir) * uCamera.w;","        float diffuseFactor = max(dot(normal, lightNormal), 0.0);","        float radius = (light.radius / res.x * uCamera.w) * uCamera.w;","        float attenuation = clamp(1.0 - distToSurf * distToSurf / (radius * radius), 0.0, 1.0);","        vec3 diffuse = light.color * diffuseFactor;","        finalColor += (attenuation * diffuse) * light.intensity;","    }","","    vec4 colorOutput = vec4(uAmbientLightColor + finalColor, 1.0);","","    gl_FragColor = color * vec4(colorOutput.rgb * colorOutput.a, colorOutput.a);","}",""].join("\n")},4934:t=>{t.exports=["#define SHADER_NAME PHASER_LINEAR_BLEND_FS","","precision mediump float;","","uniform sampler2D uMainSampler1;","uniform sampler2D uMainSampler2;","uniform float uStrength;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 frame1 = texture2D(uMainSampler1, outTexCoord);","    vec4 frame2 = texture2D(uMainSampler2, outTexCoord);","","    gl_FragColor = mix(frame1, frame2 * uStrength, 0.5);","}",""].join("\n")},53121:t=>{t.exports=["#define SHADER_NAME PHASER_MULTI_FS","","precision mediump float;","","uniform sampler2D uMainSampler[%count%];","","varying vec2 outTexCoord;","varying float outTexId;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    vec4 texture;","","    %forloop%","","    vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);","","    //  Multiply texture tint","    vec4 color = texture * texel;","","    if (outTintEffect == 1.0)","    {","        //  Solid color + texture alpha","        color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);","    }","    else if (outTintEffect == 2.0)","    {","        //  Solid color, no texture","        color = texel;","    }","","    gl_FragColor = color;","}",""].join("\n")},31952:t=>{t.exports=["#define SHADER_NAME PHASER_MULTI_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","attribute float inTexId;","attribute float inTintEffect;","attribute vec4 inTint;","","varying vec2 outTexCoord;","varying float outTexId;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outTexCoord = inTexCoord;","    outTexId = inTexId;","    outTint = inTint;","    outTintEffect = inTintEffect;","}",""].join("\n")},91101:t=>{t.exports=["#define SHADER_NAME PHASER_POINTLIGHT_FS","","precision mediump float;","","uniform vec2 uResolution;","uniform float uCameraZoom;","","varying vec4 lightPosition;","varying vec4 lightColor;","varying float lightRadius;","varying float lightAttenuation;","","void main ()","{","    vec2 center = (lightPosition.xy + 1.0) * (uResolution.xy * 0.5);","","    float distToSurf = length(center - gl_FragCoord.xy);","","    float radius = 1.0 - distToSurf / (lightRadius * uCameraZoom);","","    float intensity = smoothstep(0.0, 1.0, radius * lightAttenuation);","","    vec4 color = vec4(intensity, intensity, intensity, 0.0) * lightColor;","","    gl_FragColor = vec4(color.rgb * lightColor.a, color.a);","}",""].join("\n")},90117:t=>{t.exports=["#define SHADER_NAME PHASER_POINTLIGHT_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inLightPosition;","attribute vec4 inLightColor;","attribute float inLightRadius;","attribute float inLightAttenuation;","","varying vec4 lightPosition;","varying vec4 lightColor;","varying float lightRadius;","varying float lightAttenuation;","","void main ()","{","    lightColor = inLightColor;","    lightRadius = inLightRadius;","    lightAttenuation = inLightAttenuation;","    lightPosition = uProjectionMatrix * vec4(inLightPosition, 1.0, 1.0);","","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","}",""].join("\n")},42193:t=>{t.exports=["#define SHADER_NAME PHASER_QUAD_VS","","precision mediump float;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","","varying vec2 outFragCoord;","varying vec2 outTexCoord;","","void main ()","{","    outFragCoord = inPosition.xy * 0.5 + 0.5;","    outTexCoord = inTexCoord;","","    gl_Position = vec4(inPosition, 0, 1);","}",""].join("\n")},77917:t=>{t.exports=["#define SHADER_NAME PHASER_SINGLE_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","","varying vec2 outTexCoord;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    vec4 texture = texture2D(uMainSampler, outTexCoord);","    vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);","","    //  Multiply texture tint","    vec4 color = texture * texel;","","    if (outTintEffect == 1.0)","    {","        //  Solid color + texture alpha","        color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);","    }","    else if (outTintEffect == 2.0)","    {","        //  Solid color, no texture","        color = texel;","    }","","    gl_FragColor = color;","}",""].join("\n")},85833:t=>{t.exports=["#define SHADER_NAME PHASER_SINGLE_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","attribute float inTexId;","attribute float inTintEffect;","attribute vec4 inTint;","","varying vec2 outTexCoord;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outTexCoord = inTexCoord;","    outTint = inTint;","    outTintEffect = inTintEffect;","}",""].join("\n")},25376:t=>{t.exports="enterfullscreen"},11313:t=>{t.exports="fullscreenfailed"},13578:t=>{t.exports="fullscreenunsupported"},48530:t=>{t.exports="leavefullscreen"},76037:t=>{t.exports="orientationchange"},43067:t=>{t.exports="resize"},48958:(t,e,i)=>{t.exports={ENTER_FULLSCREEN:i(25376),FULLSCREEN_FAILED:i(11313),FULLSCREEN_UNSUPPORTED:i(13578),LEAVE_FULLSCREEN:i(48530),ORIENTATION_CHANGE:i(76037),RESIZE:i(43067)}},97648:t=>{t.exports="addtexture"},84554:t=>{t.exports="onerror"},75990:t=>{t.exports="onload"},43859:t=>{t.exports="ready"},28996:t=>{t.exports="removetexture"},61632:(t,e,i)=>{t.exports={ADD:i(97648),ERROR:i(84554),LOAD:i(75990),READY:i(43859),REMOVE:i(28996)}},12229:t=>{var e=function(t){var i,r,s;if("object"!=typeof t||null===t)return t;for(s in i=Array.isArray(t)?[]:{},t)r=t[s],i[s]=e(r);return i};t.exports=e}}]);
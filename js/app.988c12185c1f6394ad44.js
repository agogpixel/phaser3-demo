"use strict";(self.webpackChunk_agogpixel_phaser3_demo=self.webpackChunk_agogpixel_phaser3_demo||[]).push([[2143],{77649:(t,e,a)=>{a.r(e),a.d(e,{app:()=>h});var i=a(70655),r=function(t){function e(a,i,r,n){void 0===n&&(n="left");var s,o=t.call(this,a,i,r,e.textureKey,n)||this;switch(o.facing=n,n){case"right":s=e.originRightFacing;break;case"left":default:s=e.originLeftFacing}return o.setOrigin(s.x,s.y),o}return(0,i.ZT)(e,t),e.generateTexture=function(t){var a,r,n=t.make.tilemap({key:e.tilemapKey}),s=n.addTilesetImage(e.tilesetName),o=n.createLayer(e.tilemapLayerID,s);t.children.remove(o);var h=t.make.renderTexture({x:0,y:0,width:o.width,height:o.height},!1),l=h.draw(o).saveTexture(e.textureKey),c=JSON.parse(o.layer.properties.find((function(t){return t.name===e.tilemapLayerPropertyName})).value);try{for(var g=(0,i.XA)(Object.entries(c)),d=g.next();!d.done;d=g.next()){var p=(0,i.CR)(d.value,2),u=p[0],y=(0,i.CR)(p[1],4),m=y[0],f=y[1],v=y[2],b=y[3];l.add(u,0,m,f,v,b)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(r=g.return)&&r.call(g)}finally{if(a)throw a.error}}return n.destroy(),h.destroy(),l},e.prototype.castLighting=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=1),a=Phaser.Math.Clamp(a,0,1),e=Phaser.Math.Clamp(e,0,a);var i=this.calculateLightbar();this.castLightbar(i,t,a),this.castRays(i,t,e,a),this.castForeground(i,t,e,a),t.refresh()},e.prototype.calculateLightbar=function(){var t;switch(this.facing){case"right":t=e.lightbarOriginRightFacing;break;case"left":default:t=e.lightbarOriginLeftFacing}var a=e.lightbarDimensions,i=this.getTopLeft(void 0,!0),r=Math.floor(i.x+this.displayWidth*t.x),n=Math.floor(i.y+this.displayHeight*t.y),s=Math.floor(a.x*this.scaleX),o=Math.floor(a.y*this.scaleY);return new Phaser.Geom.Rectangle(r,n,s,o)},e.prototype.castLightbar=function(t,e,a){for(var i=e.context.getImageData(t.x,t.y,t.width,t.height),r=0;r<t.height;++r)for(var n=0;n<t.width;++n){var s=4*(r*i.width+n);i.data[s+3]=Math.floor(255*(1-a))}e.context.putImageData(i,t.x,t.y)},e.prototype.castRays=function(t,e,a,i){for(var r=t.bottom,n=this.getBottomCenter().y-r,s=0;s<n;s+=1){for(var o=s+1,h=2*o,l=t.width+h,c=2*o,g=2*c,d=t.left-o-c,p=t.bottom+s,u=l+g,y=e.context.getImageData(d,p,u,1),m=0;m<1;++m)for(var f=0;f<u;++f){var v=i;f<c?v=Phaser.Math.Clamp(i*((f+1)/c),a,i):f>=c+l&&(v=Phaser.Math.Clamp(i*((c-(f-(c+l)+1))/c),a,i));var b=4*(m*y.width+f);y.data[b+3]=255*(1-v)}e.context.putImageData(y,d,p)}},e.prototype.castForeground=function(t,a,i,r){for(var n=t.bottom,s=this.getBottomCenter().y-n,o=Math.floor(e.lightbarCastForegroundMagnitude*this.scaleY),h=0;h<o;h+=1){for(var l=s-h,c=2*l,g=t.width+c,d=2*l,p=2*d,u=t.left-l-d,y=t.bottom+s+h,m=g+p,f=a.context.getImageData(u,y,m,1),v=0;v<1;++v)for(var b=0;b<m;++b){var x=r;b<d?x=Phaser.Math.Clamp(r*((b+1)/d),i,r):b>=d+g&&(x=Phaser.Math.Clamp(r*((d-(b-(d+g)+1))/d),i,r)),x*=1-(h+1)/o,x=Phaser.Math.Clamp(x,i,r);var k=4*(v*f.width+b);f.data[k+3]=255*(1-x)}a.context.putImageData(f,u,y)}},e.key="lightpost",e.textureKey="lightpost",e.tilemapKey="lightpost",e.tilemapLayerID="layer1",e.tilemapLayerPropertyName="frames",e.tilesetName="roguelikeCity_transparent",e.originLeftFacing=new Phaser.Math.Vector2(.75,1),e.originRightFacing=new Phaser.Math.Vector2(.25,1),e.lightbarOriginLeftFacing=new Phaser.Math.Vector2(.125,.085),e.lightbarOriginRightFacing=new Phaser.Math.Vector2(.5625,.085),e.lightbarDimensions=new Phaser.Math.Vector2(5,1),e.lightbarCastForegroundMagnitude=24,e.creator=function(t,a){var i=new e(this.scene,0,0,t.facing);return void 0!==a&&(t.add=a),Phaser.GameObjects.BuildGameObject(this.scene,i,t),i},e.factory=function(t,a,i){return this.displayList.add(new e(this.scene,t,a,i))},e}(Phaser.GameObjects.Image),n=function(t){function e(e){var a=t.call(this,e)||this;return e.registerGameObject(r.key,r.factory,r.creator),a}return(0,i.ZT)(e,t),e.key="lightpostPlugin",e}(Phaser.Plugins.BasePlugin),s=function(t){function e(){return t.call(this,e.key)||this}return(0,i.ZT)(e,t),e.prototype.init=function(){this.input.keyboard.enabled=!1},e.prototype.create=function(){var t=this;this.cameras.main.setAlpha(0),this.events.once(Phaser.Scenes.Events.TRANSITION_START,(function(e,a){t.tweens.add({targets:t.cameras.main,alpha:1,duration:a,delay:1e3,onComplete:function(){return t.input.keyboard.enabled=!0}})}));var a=e.scaleFactor,i=this.make.tilemap({key:"background",insertNull:!0}),r=i.addTilesetImage("roguelikeCity_transparent"),n=i.createLayer("layer1",r).setScale(a);i.createLayer("layer2",r).setScale(a);var s=i.tileWidth/2*a,o=i.tileHeight/2*a,h=new Phaser.Math.Vector2;n.tileToWorldXY(7,9,h);var l=this.add.lightpost(h.x+s,h.y+o+o/2,"right").setScale(a).setDepth(9);n.tileToWorldXY(23,9,h);var c=this.add.lightpost(h.x+s,h.y+o+o/2,"right").setScale(a).setDepth(9);n.tileToWorldXY(15,15,h);var g=this.add.lightpost(h.x+s,h.y+o-o/2,"left").setScale(a).setDepth(15),d=this.add.particles("blue").setDepth(12).createEmitter({x:{min:0,max:n.displayWidth},y:0,lifespan:{min:200,max:1e3},speedY:1500,scaleY:{min:1,max:4},scaleX:.01,quantity:1,blendMode:"SCREEN",emitCallback:function(t){return d.manager.setDepth(Phaser.Math.RND.integerInRange(2,50))}}),p=this.textures.createCanvas("lighting",n.displayWidth,n.displayHeight);p.context.fillStyle="rgba(0, 0, 0, 0.75)",p.context.fillRect(0,0,n.displayWidth,n.displayHeight),l.castLighting(p,.25),c.castLighting(p,.25),g.castLighting(p,.25),this.add.image(0,0,"lighting").setOrigin(0).setDepth(100);var u=this.input.keyboard.createCursorKeys();this.controls=new Phaser.Cameras.Controls.FixedKeyControl({camera:this.cameras.main,left:u.left,right:u.right,up:u.up,down:u.down,speed:.5,zoomIn:this.input.keyboard.addKey("MINUS"),zoomOut:this.input.keyboard.addKey("PLUS"),maxZoom:3,minZoom:.5}),this.add.text(0,0,["Cursor keys to move camera.","Zoom In: +","Zoom Out: -"],{fontSize:"32px",color:"#ff00ff"}).setDepth(1e3).setScrollFactor(0),this.cameras.main.setBounds(0,0,n.displayWidth,n.displayHeight),this.cameras.main.centerOn(n.displayWidth/2,n.displayHeight/2)},e.prototype.update=function(t,e){this.controls.update(e)},e.key="Main",e.scaleFactor=4,e}(Phaser.Scene),o=function(t){function e(){return t.call(this,e.key)||this}return(0,i.ZT)(e,t),e.prototype.preload=function(){this.load.image("roguelikeCity_transparent","assets/roguelikeCity_transparent.png"),this.load.tilemapTiledJSON("background","assets/background.json"),this.load.tilemapTiledJSON("lightpost","assets/lightpost.json"),this.load.image("blue","assets/blue.png")},e.prototype.create=function(){r.generateTexture(this),this.scene.transition({target:s.key,duration:1500,sleep:!1,allowInput:!1,onUpdate:function(t){var e=document.getElementById("splashContainer").style;e.opacity=(1-t).toString(),1===t&&(e.display="none",e.opacity="1")}})},e.key="Preload",e}(Phaser.Scene);function h(){new Phaser.Game({title:"agogpixel/phaser3-demo",version:"0.0.0",type:Phaser.AUTO,parent:"body",pixelArt:!0,dom:{createContainer:!0},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1600,height:900},plugins:{global:[{key:n.key,plugin:n,start:!0}]},scene:[o,s]})}}}]);